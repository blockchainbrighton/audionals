<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book & Poster Cover Creator</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #1a1a1a; color: white; }
        
        /* Custom Scrollbar for asset lists */
        .asset-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .asset-scroll::-webkit-scrollbar-track {
            background: #2d2d2d;
        }
        .asset-scroll::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .asset-scroll::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Inline Icons to ensure stability without external dependencies ---
        const Icons = {
            Book: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
            ),
            Download: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            ),
            Image: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            ),
            Type: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>
            ),
            User: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            ),
            Move: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="19 9 22 12 19 15"/><polyline points="9 19 12 22 15 19"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>
            ),
            Plus: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            ),
        };

        const { Download, Image, Type, User, Move, Book, Plus } = Icons;

        // --- Default Assets Configuration ---
        // These paths match the structure provided in the prompt. 
        // If the HTML file is placed in the root of the zip contents, these will load.
        const DEFAULT_ASSETS = {
            bookCovers: [
                { name: 'Battle Scene', src: './Book Cover Creator bk/Cover-Image-2/2-3-ratio-book-cover-images-here/lighter-battle-v9.png' },
            ],
            posterCovers: [
                // Placeholder for poster logic - users can add poster images to a similar folder structure
                { name: 'Poster Placeholder', src: 'https://placehold.co/600x800/333/666?text=Poster+Background' } 
            ],
            titles: [
                { name: 'MythSlayer', src: './Book Cover Creator bk/Title-Textput-put-transparent-pngs-here/MythSlayer-MB1-L4.png' },
            ],
            authors: [
                { name: 'Seric', src: './Book Cover Creator bk/Author-Text-put-transparent-pngs-here/Seric-mb2-L2.png' },
            ]
        };

        const DraggableItem = ({ src, position, setPosition, scale, setScale, label, isSelected, onSelect }) => {
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            
            // Handle Mouse Events
            const handleMouseDown = (e) => {
                e.stopPropagation();
                onSelect();
                setIsDragging(true);
                setDragStart({
                    x: e.clientX - position.x,
                    y: e.clientY - position.y
                });
            };

            const handleMouseMove = (e) => {
                if (isDragging) {
                    e.preventDefault();
                    setPosition({
                        x: e.clientX - dragStart.x,
                        y: e.clientY - dragStart.y
                    });
                }
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            // Handle Touch Events for Mobile
            const handleTouchStart = (e) => {
                e.stopPropagation();
                onSelect();
                setIsDragging(true);
                const touch = e.touches[0];
                setDragStart({
                    x: touch.clientX - position.x,
                    y: touch.clientY - position.y
                });
            };

            const handleTouchMove = (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    setPosition({
                        x: touch.clientX - dragStart.x,
                        y: touch.clientY - dragStart.y
                    });
                }
            };

            const handleTouchEnd = () => {
                setIsDragging(false);
            };

            useEffect(() => {
                if (isDragging) {
                    window.addEventListener('mousemove', handleMouseMove);
                    window.addEventListener('mouseup', handleMouseUp);
                    window.addEventListener('touchmove', handleTouchMove, { passive: false });
                    window.addEventListener('touchend', handleTouchEnd);
                }
                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                    window.removeEventListener('touchmove', handleTouchMove);
                    window.removeEventListener('touchend', handleTouchEnd);
                };
            }, [isDragging, dragStart]);

            if (!src) return null;

            return (
                <div 
                    style={{ 
                        position: 'absolute', 
                        left: position.x, 
                        top: position.y,
                        transform: `scale(${scale})`,
                        transformOrigin: 'center center',
                        cursor: isDragging ? 'grabbing' : 'grab',
                        border: isSelected ? '2px dashed #3b82f6' : '2px dashed transparent',
                        padding: '4px'
                    }}
                    onMouseDown={handleMouseDown}
                    onTouchStart={handleTouchStart}
                >
                    <img 
                        src={src} 
                        alt={label} 
                        className="pointer-events-none select-none max-w-[300px]" 
                        style={{ display: 'block' }}
                    />
                    {isSelected && (
                        <div className="absolute -top-6 left-0 bg-blue-500 text-white text-xs px-2 py-0.5 rounded shadow whitespace-nowrap">
                            {label} (Drag to move)
                        </div>
                    )}
                </div>
            );
        };

        const AssetPicker = ({ title, icon: Icon, assets, selectedSrc, onSelect, onUpload }) => (
            <div className="mb-6">
                <div className="flex justify-between items-center mb-2">
                    <h3 className="text-sm font-semibold text-gray-300 flex items-center gap-2">
                        <Icon size={16} /> {title}
                    </h3>
                    <label className="cursor-pointer bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded flex items-center gap-1 transition-colors">
                        <Plus size={12} /> Add Files
                        <input 
                            type="file" 
                            multiple 
                            accept="image/*" 
                            className="hidden" 
                            onChange={(e) => onUpload(e.target.files)}
                        />
                    </label>
                </div>
                
                <div className="flex gap-2 overflow-x-auto asset-scroll pb-2">
                    {assets.map((asset, idx) => (
                        <button
                            key={idx}
                            onClick={() => onSelect(asset.src)}
                            className={`flex-shrink-0 w-20 h-20 rounded border-2 overflow-hidden relative group ${
                                selectedSrc === asset.src ? 'border-blue-500' : 'border-gray-700 hover:border-gray-500'
                            }`}
                        >
                            <img src={asset.src} alt={asset.name} className="w-full h-full object-cover" />
                            <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <span className="text-[10px] text-white px-1 text-center truncate w-full">{asset.name}</span>
                            </div>
                        </button>
                    ))}
                    {assets.length === 0 && (
                        <div className="text-xs text-gray-500 italic p-2">No images found</div>
                    )}
                </div>
            </div>
        );

        const App = () => {
            // Mode State
            const [mode, setMode] = useState('book'); // 'book' (2:3) or 'poster' (3:4)

            // Asset Libraries State
            const [libraries, setLibraries] = useState({
                bookCovers: DEFAULT_ASSETS.bookCovers,
                posterCovers: DEFAULT_ASSETS.posterCovers,
                titles: DEFAULT_ASSETS.titles,
                authors: DEFAULT_ASSETS.authors
            });

            // Canvas State
            const [activeCover, setActiveCover] = useState(DEFAULT_ASSETS.bookCovers[0]?.src || null);
            const [activeTitle, setActiveTitle] = useState(DEFAULT_ASSETS.titles[0]?.src || null);
            const [activeAuthor, setActiveAuthor] = useState(DEFAULT_ASSETS.authors[0]?.src || null);

            // Positioning State
            const [titlePos, setTitlePos] = useState({ x: 50, y: 50 });
            const [titleScale, setTitleScale] = useState(1);
            
            const [authorPos, setAuthorPos] = useState({ x: 50, y: 500 });
            const [authorScale, setAuthorScale] = useState(1);

            const [selectedLayer, setSelectedLayer] = useState(null); // 'title' or 'author'

            const canvasRef = useRef(null);

            // Handle switching modes
            const switchMode = (newMode) => {
                setMode(newMode);
                // Reset background to the first available in that category
                if (newMode === 'book') {
                    setActiveCover(libraries.bookCovers[0]?.src || null);
                } else {
                    setActiveCover(libraries.posterCovers[0]?.src || null);
                }
            };

            // Handle File Uploads (Temporary URL creation)
            const handleUpload = (files, category) => {
                const newAssets = Array.from(files).map(file => ({
                    name: file.name,
                    src: URL.createObjectURL(file)
                }));

                setLibraries(prev => ({
                    ...prev,
                    [category]: [...newAssets, ...prev[category]]
                }));

                // Auto-select the first uploaded item
                if (newAssets.length > 0) {
                    if (category === 'bookCovers' && mode === 'book') setActiveCover(newAssets[0].src);
                    if (category === 'posterCovers' && mode === 'poster') setActiveCover(newAssets[0].src);
                    if (category === 'titles') setActiveTitle(newAssets[0].src);
                    if (category === 'authors') setActiveAuthor(newAssets[0].src);
                }
            };

            // Download Logic
            const downloadCanvas = () => {
                alert("To save: Take a screenshot! \n(Full image export requires hosting the app on a server to avoid security restrictions with local files).");
            };

            return (
                <div className="flex flex-col h-screen bg-neutral-900 text-neutral-100 overflow-hidden">
                    
                    {/* Header */}
                    <header className="h-16 border-b border-neutral-800 flex items-center justify-between px-6 bg-neutral-900 z-10">
                        <div className="flex items-center gap-3">
                            <Book className="text-blue-500" size={24} />
                            <h1 className="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                Cover Creator
                            </h1>
                        </div>
                        
                        <div className="flex bg-neutral-800 p-1 rounded-lg">
                            <button 
                                onClick={() => switchMode('book')}
                                className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${mode === 'book' ? 'bg-blue-600 text-white shadow' : 'text-gray-400 hover:text-white'}`}
                            >
                                Book (2:3)
                            </button>
                            <button 
                                onClick={() => switchMode('poster')}
                                className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${mode === 'poster' ? 'bg-purple-600 text-white shadow' : 'text-gray-400 hover:text-white'}`}
                            >
                                Poster (3:4)
                            </button>
                        </div>

                        <button 
                            onClick={downloadCanvas}
                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-colors"
                        >
                            <Download size={16} /> Save
                        </button>
                    </header>

                    <div className="flex flex-1 overflow-hidden">
                        
                        {/* Sidebar Controls */}
                        <aside className="w-80 border-r border-neutral-800 bg-neutral-900 flex flex-col overflow-y-auto z-10">
                            <div className="p-6">
                                <h2 className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-6">Assets Library</h2>

                                {/* Backgrounds */}
                                <AssetPicker 
                                    title={mode === 'book' ? "Book Covers" : "Poster Backgrounds"}
                                    icon={Image}
                                    assets={mode === 'book' ? libraries.bookCovers : libraries.posterCovers}
                                    selectedSrc={activeCover}
                                    onSelect={setActiveCover}
                                    onUpload={(files) => handleUpload(files, mode === 'book' ? 'bookCovers' : 'posterCovers')}
                                />

                                {/* Titles */}
                                <AssetPicker 
                                    title="Title Text"
                                    icon={Type}
                                    assets={libraries.titles}
                                    selectedSrc={activeTitle}
                                    onSelect={(src) => { setActiveTitle(src); setSelectedLayer('title'); }}
                                    onUpload={(files) => handleUpload(files, 'titles')}
                                />

                                {/* Authors */}
                                <AssetPicker 
                                    title="Author Text"
                                    icon={User}
                                    assets={libraries.authors}
                                    selectedSrc={activeAuthor}
                                    onSelect={(src) => { setActiveAuthor(src); setSelectedLayer('author'); }}
                                    onUpload={(files) => handleUpload(files, 'authors')}
                                />

                                <div className="border-t border-neutral-800 pt-6 mt-2">
                                    <h2 className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Current Layer Settings</h2>
                                    
                                    {selectedLayer ? (
                                        <div className="space-y-4">
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm font-medium text-blue-400 capitalize">{selectedLayer} Layer</span>
                                                <button onClick={() => setSelectedLayer(null)} className="text-xs text-gray-500 hover:text-white">Deselect</button>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-400 mb-1 block">Scale</label>
                                                <input 
                                                    type="range" 
                                                    min="0.1" 
                                                    max="3" 
                                                    step="0.1"
                                                    value={selectedLayer === 'title' ? titleScale : authorScale}
                                                    onChange={(e) => selectedLayer === 'title' ? setTitleScale(parseFloat(e.target.value)) : setAuthorScale(parseFloat(e.target.value))}
                                                    className="w-full accent-blue-500 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                                />
                                            </div>
                                            
                                            <p className="text-xs text-gray-500">
                                                <Move size={10} className="inline mr-1"/>
                                                Drag the element on the canvas to move it.
                                            </p>
                                        </div>
                                    ) : (
                                        <div className="text-sm text-gray-600 italic py-2">
                                            Click an element on the canvas or select a text image to adjust settings.
                                        </div>
                                    )}
                                </div>

                            </div>
                        </aside>

                        {/* Main Stage */}
                        <main className="flex-1 bg-[#121212] relative overflow-hidden flex items-center justify-center p-8">
                            {/* Grid Pattern Background */}
                            <div className="absolute inset-0 opacity-10 pointer-events-none" 
                                 style={{ backgroundImage: 'radial-gradient(#444 1px, transparent 1px)', backgroundSize: '20px 20px' }}>
                            </div>

                            {/* Canvas Container */}
                            <div 
                                ref={canvasRef}
                                className="relative bg-white shadow-2xl overflow-hidden transition-all duration-300 ease-in-out"
                                style={{
                                    // Aspect Ratio Calculations
                                    width: mode === 'book' ? '60vh' : '50vh', 
                                    height: mode === 'book' ? '90vh' : '66.6vh', // 2:3 ratio vs 3:4 ratio approx
                                    maxHeight: '800px',
                                    aspectRatio: mode === 'book' ? '2/3' : '3/4'
                                }}
                            >
                                {/* Base Cover Image */}
                                {activeCover ? (
                                    <img 
                                        src={activeCover} 
                                        alt="Background" 
                                        className="w-full h-full object-cover select-none"
                                        draggable="false"
                                    />
                                ) : (
                                    <div className="w-full h-full bg-gray-200 flex flex-col items-center justify-center text-gray-400">
                                        <Image size={48} className="mb-2 opacity-50"/>
                                        <span className="text-sm">No Cover Selected</span>
                                    </div>
                                )}

                                {/* Overlay Layers */}
                                <DraggableItem 
                                    src={activeTitle} 
                                    position={titlePos} 
                                    setPosition={setTitlePos}
                                    scale={titleScale}
                                    setScale={setTitleScale}
                                    label="Title"
                                    isSelected={selectedLayer === 'title'}
                                    onSelect={() => setSelectedLayer('title')}
                                />

                                <DraggableItem 
                                    src={activeAuthor} 
                                    position={authorPos} 
                                    setPosition={setAuthorPos}
                                    scale={authorScale}
                                    setScale={setAuthorScale}
                                    label="Author"
                                    isSelected={selectedLayer === 'author'}
                                    onSelect={() => setSelectedLayer('author')}
                                />

                            </div>

                            {/* Canvas Info */}
                            <div className="absolute bottom-4 right-4 bg-black/50 text-white text-xs px-3 py-1.5 rounded-full backdrop-blur-sm">
                                {mode === 'book' ? '2:3 Ratio (Standard Book)' : '3:4 Ratio (Poster)'}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>