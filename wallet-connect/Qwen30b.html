<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Turbo Laser Eyes Wallet Connect Debugger</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background-color: #121212;
      color: #e0e0e0;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      color: #ff3399;
      margin-bottom: 10px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #444;
      border-radius: 8px;
      background-color: #1e1e1e;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background-color: #ff3399;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-bottom: 20px;
    }
    .btn:hover {
      background-color: #e0227a;
    }
    .btn:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
    .copy-btn {
      padding: 8px 16px;
      font-size: 14px;
      margin-top: 10px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .copy-btn:hover {
      background-color: #005f99;
    }
    .log-area {
      width: 100%;
      height: 300px;
      overflow-y: scroll;
      border: 1px solid #444;
      padding: 12px;
      background-color: #0f0f0f;
      color: #b0b0b0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      border-radius: 6px;
    }
    .status {
      margin-top: 10px;
      font-size: 15px;
      color: #aaa;
    }
    .success {
      color: #4caf50;
    }
    .error {
      color: #f44336;
    }
    .info {
      color: #2196f3;
    }
    .debug {
      color: #9c27b0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Turbo Laser Eyes Wallet Connect Debugger</h1>

    <!-- Connect Button -->
    <button id="connectBtn" class="btn">Connect Xverse Wallet</button>

    <!-- Status Display -->
    <div id="status" class="status">Not connected</div>

    <!-- Copy Logs Button -->
    <button id="copyLogsBtn" class="copy-btn">Copy Logs</button>

    <!-- Log Area -->
    <div id="logArea" class="log-area"></div>
  </div>

  <!-- Laser Eyes SDK via CDN -->
  <!-- Note: As of now, Laser Eyes does not have a public CDN. This is a placeholder for the real SDK. -->
  <!-- In practice, you would replace this with the actual script URL from Laser Eyes. -->
  <!-- For demo purposes, we simulate the SDK behavior with a mock object. -->
  <!-- Real integration requires official SDK: https://docs.laser-eyes.xyz -->

  <script>
    // =============== CONFIG SECTION ===============
    // üîë Replace with your actual Laser Eyes API key if required
    const LASER_EYES_API_KEY = "your-laser-eyes-api-key-here"; // ‚Üê Placeholder

    // Optional: Set to true to enable verbose debugging (all raw events)
    const DEBUG_MODE = true;

    // =============== LOGGING SYSTEM ===============
    const logArea = document.getElementById("logArea");
    const statusEl = document.getElementById("status");
    const connectBtn = document.getElementById("connectBtn");
    const copyLogsBtn = document.getElementById("copyLogsBtn");

    function log(message, type = "info") {
      const timestamp = new Date().toISOString().slice(11, 23);
      const entry = `[${timestamp}] ${message}`;
      logArea.textContent += entry + "\n";
      logArea.scrollTop = logArea.scrollHeight;

      // Colorize based on type
      const lastLine = logArea.lastChild;
      if (lastLine) {
        lastLine.style.color = {
          success: "#4caf50",
          error: "#f44336",
          info: "#2196f3",
          debug: "#9c27b0"
        }[type] || "#b0b0b0";
      }

      // If in debug mode, log full event objects
      if (DEBUG_MODE && type === "debug") {
        console.log(message);
      }
    }

    // =============== MOCK LASER EYES SDK (for demo) ===============
    // ‚ö†Ô∏è This is NOT the real Laser Eyes SDK!
    // Replace this entire block with the real SDK when available.
    // The real SDK should be loaded via CDN like:
    // <script src="https://cdn.jsdelivr.net/npm/@laser-eyes/sdk@latest/dist/index.min.js"></script>
    //
    // For now, we simulate the expected interface.

    let laserEyesSDK = null;

    // Simulate async loading of Laser Eyes SDK
    window.laserEyes = {
      init: function(config) {
        return new Promise((resolve, reject) => {
          log("Initializing Laser Eyes SDK...", "debug");
          setTimeout(() => {
            if (!config?.apiKey) {
              reject(new Error("API key is required"));
              return;
            }
            laserEyesSDK = {
              connect: (options) => {
                log(`Attempting connection with options: ${JSON.stringify(options)}`, "debug");
                return new Promise((resolve, reject) => {
                  // Simulate wallet popup delay
                  setTimeout(() => {
                    // Simulate success or failure
                    const success = Math.random() > 0.3; // 70% chance of success
                    if (success) {
                      const walletInfo = {
                        address: "bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq",
                        chainId: 1,
                        network: "bitcoin-mainnet",
                        walletType: "xverse",
                        metadata: { name: "Xverse", version: "1.4.5" }
                      };
                      log("‚úÖ Wallet connected successfully!", "success");
                      log(`Wallet Address: ${walletInfo.address}`, "info");
                      statusEl.textContent = `Connected: ${walletInfo.address.substring(0, 10)}...`;
                      resolve(walletInfo);
                    } else {
                      log("‚ùå Wallet connection failed (simulated)", "error");
                      statusEl.textContent = "Connection failed";
                      reject(new Error("User denied connection or wallet not found"));
                    }
                  }, 1500);
                });
              },
              disconnect: () => {
                log("Disconnecting wallet...", "info");
                statusEl.textContent = "Disconnected";
                return Promise.resolve();
              },
              getAccount: () => {
                log("Getting account info...", "debug");
                return Promise.resolve({
                  address: "bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq",
                  chainId: 1,
                  network: "bitcoin-mainnet"
                });
              },
              on: (event, callback) => {
                log(`Listening for event: ${event}`, "debug");
                // Simulate event firing
                if (event === "connect") {
                  setTimeout(() => {
                    callback({ address: "bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq" });
                  }, 1000);
                }
                if (event === "disconnect") {
                  setTimeout(() => {
                    callback();
                  }, 2000);
                }
              }
            };
            log("Laser Eyes SDK initialized successfully.", "success");
            resolve(laserEyesSDK);
          }, 500);
        });
      },
      ready: function() {
        return new Promise(resolve => {
          setTimeout(() => {
            if (laserEyesSDK) {
              resolve(true);
            } else {
              resolve(false);
            }
          }, 100);
        });
      }
    };

    // =============== REAL SDK LOADING (if available) ===============
    // Uncomment and update this section when the real SDK is available:
    /*
    const loadLaserEyesSDK = () => {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@laser-eyes/sdk@latest/dist/index.min.js';
        script.onload = () => {
          log("Laser Eyes SDK loaded successfully.", "success");
          resolve(window.laserEyes);
        };
        script.onerror = () => {
          log("‚ùå Failed to load Laser Eyes SDK. Using mock instead.", "error");
          resolve(null); // fallback to mock
        };
        document.head.appendChild(script);
      });
    };
    */

    // =============== CONNECTION LOGIC ===============
    let walletInstance = null;

    async function connectWallet() {
      connectBtn.disabled = true;
      connectBtn.textContent = "Connecting...";

      try {
        log("üöÄ Starting wallet connection process...", "info");

        // Check if SDK is ready
        if (!laserEyesSDK) {
          log("‚ö†Ô∏è SDK not initialized yet. Attempting to initialize...", "debug");
          // Try to initialize with config
          try {
            await window.laserEyes.init({
              apiKey: LASER_EYES_API_KEY,
              wallets: ["xverse", "bitpie", "blockchain", "ledger"]
            });
            log("‚úÖ SDK initialization complete.", "success");
          } catch (err) {
            log(`‚ùå SDK init failed: ${err.message}`, "error");
            throw err;
          }
        }

        // Now attempt connection
        const options = {
          walletTypes: ["xverse"],
          timeout: 10000,
          onSuccess: (data) => {
            log("üî• Connection success callback fired", "info");
            log(JSON.stringify(data, null, 2), "debug");
          },
          onError: (err) => {
            log(`üö® Connection error: ${err.message}`, "error");
          }
        };

        log("üìû Calling laserEyes.connect(...)", "debug");
        walletInstance = await window.laserEyes.connect(options);

        log("üéâ Wallet connection established!", "success");
        statusEl.className = "status success";
        statusEl.textContent = `Connected: ${walletInstance.address.substring(0, 10)}...`;

        // Listen for additional events
        window.laserEyes.on("disconnect", () => {
          log("üîî Wallet disconnected event received", "info");
          statusEl.className = "status";
          statusEl.textContent = "Disconnected";
          walletInstance = null;
        });

        // Auto-log account info
        const account = await window.laserEyes.getAccount();
        log(`üë§ Account Info: ${JSON.stringify(account, null, 2)}`, "debug");

      } catch (err) {
        log(`üí• Connection failed: ${err.message}`, "error");
        statusEl.className = "status error";
        statusEl.textContent = "Connection failed";
        walletInstance = null;
      } finally {
        connectBtn.disabled = false;
        connectBtn.textContent = "Connect Xverse Wallet";
      }
    }

    // =============== EVENT HANDLERS ===============
    connectBtn.addEventListener("click", connectWallet);

    copyLogsBtn.addEventListener("click", () => {
      const logs = logArea.textContent.trim();
      if (!logs) {
        alert("No logs to copy.");
        return;
      }

      navigator.clipboard.writeText(logs)
        .then(() => {
          log("üìã Logs copied to clipboard!", "success");
        })
        .catch(err => {
          log(`‚ùå Failed to copy logs: ${err.message}`, "error");
          alert("Failed to copy logs. Please try again.");
        });
    });

    // =============== INITIAL SETUP ===============
    log("üîß App initialized. Ready to connect.", "info");
    log("üí° Tip: Click \"Connect Xverse Wallet\" to begin.", "info");

    // Optional: Auto-check readiness
    setInterval(async () => {
      try {
        const ready = await window.laserEyes.ready();
        if (!ready) {
          log("‚è≥ Waiting for Laser Eyes SDK to become ready...", "debug");
        }
      } catch (err) {
        log(`üîç Readiness check error: ${err.message}`, "debug");
      }
    }, 2000);

  </script>
</body>
</html>