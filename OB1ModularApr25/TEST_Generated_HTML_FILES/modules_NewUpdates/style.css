/* =============================
   Refactored Stylesheet – April 2025
   – selectors preserved 100 % –
   – reduced line‑count / duplicated rules –
   ============================= */

/* ------------------------------------------------------------------ */
@layer reset,theme,layout,columns,components,utilities;

/* ---------- THEME -------------------------------------------------- */
@layer theme {
  :root {
    /* colours */
    --control-bg: #2a2a2a;
    --control-border: #444;
    --button-bg: #333;
    --button-hover-bg: #555;
    --button-active-bg: #6a9a6a;
    --error-color: #ff6b6b;
    --black-bg-for-hidden: #000;
    /* misc */
    --disabled-opacity: .5;
    /* transition shorthands */
    --trans-fade: opacity .3s ease-in-out, visibility 0s linear var(--fade-delay,0s);
    --trans-bg: background-color .3s ease-in-out, border-color .3s ease-in-out;
  }
}

/* ---------- RESET -------------------------------------------------- */
@layer reset {
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;padding:0;min-height:100vh;
    font-family:sans-serif;
    background:#000;color:#e0e0e0;overflow:hidden;
  }
}

/* ---------- LAYOUT ------------------------------------------------- */
@layer layout {
  .main-layout{
    display:grid;grid-template:100vh/1fr auto 1fr;
    align-items:center;gap:20px;width:100%;height:100vh;
    padding:20px;background:var(--black-bg-for-hidden);
  }
  .image-area{
    display:flex;justify-content:center;align-items:center;
    justify-self:center;align-self:center;
    max-inline-size:100%;max-block-size:calc(100vh - 40px);
  }
}

/* ---------- MEDIA (image) ----------------------------------------- */
@layer media {
  #main-image{
    display:block;
    inline-size:80vh;block-size:80vh;
    max-inline-size:calc(100vw - 80px);
    max-block-size:calc(100vh - 40px);
    object-fit:contain;border-radius:5px;
    cursor:pointer;visibility:hidden;
    transition:transform .15s ease-out;
  }
  #main-image:active{transform:scale(.98);transition-duration:.05s}

  @keyframes shake-all-directions{
    0%,100%{transform:translate(0)}
    10%{transform:translate(-5px,-5px)}20%{transform:translate(5px,-5px)}
    30%{transform:translate(-5px,5px)}40%{transform:translate(5px,5px)}
    50%{transform:translate(-5px,-5px)}60%{transform:translate(5px,5px)}
    70%{transform:translate(-5px,5px)}80%{transform:translate(5px,-5px)}
    90%{transform:translate(-5px,-5px)}
  }
  .shake-all-directions-animation{animation:shake-all-directions .15s cubic-bezier(.36,.07,.19,.97) both}
}

/* ---------- COLUMNS (shared) -------------------------------------- */
@layer columns {
  :is(.controls-column,.reference-column){
    display:flex;flex-direction:column;gap:inherit;overflow:hidden;
    block-size:100%;max-block-size:100%;min-inline-size:0;
    padding:15px;border:1px solid var(--control-border);border-radius:8px;
    background:var(--control-bg);
    opacity:1;visibility:visible;
    transition:var(--trans-fade),var(--trans-bg),padding .3s ease-in-out;
  }
  :is(.controls-column,.reference-column) > *{opacity:1;visibility:visible;transition:opacity .3s ease-in-out}

  :is(.controls-column,.reference-column).hidden{
    --fade-delay:0s;
    opacity:0;visibility:hidden;padding:0;
    background:var(--black-bg-for-hidden);border-color:var(--black-bg-for-hidden);
  }
  :is(.controls-column,.reference-column).hidden > *{opacity:0;visibility:hidden;transition:none}
}

/* ---------- COMPONENTS (controls, reference, waveform) ------------ */
@layer components {
  /* — controls area — */
  .title-bar{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;
             gap:inherit;margin-block-end:10px;padding-block-end:8px;border-block-end:1px solid #555}
  h1{margin:0;font-size:1.5em;color:#eee;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  #info-toggle-btn{background:none;border:none;color:#aaa;font-size:1.8em;cursor:pointer;padding:0 5px;line-height:1}
  #info-toggle-btn:hover{color:#fff}

  .audio-metadata{font-size:.9em;color:#aaa;line-height:1.3;flex-shrink:0;
                  margin:0 0 15px;padding:0 5px;text-align:left}
  .audio-metadata span{white-space:nowrap}

  .controls{
    display:flex;flex-direction:column;gap:15px;flex-grow:1;overflow-y:auto;
    width:100%;padding:0;background:transparent;border:none;color:#ccc;
  }
  .button-group{display:flex;gap:10px;flex-wrap:wrap}
  button{background:var(--button-bg);border:1px solid var(--control-border);color:#ddd;
         padding:8px 15px;border-radius:4px;font-size:.9em;cursor:pointer;transition:background-color .2s}
  button:hover:not(:disabled){background:var(--button-hover-bg)}
  button.active{background:var(--button-active-bg);font-weight:bold}
  button:disabled{opacity:var(--disabled-opacity);cursor:not-allowed}

  .control-group{display:flex;align-items:center;flex-wrap:wrap;gap:10px}
  .control-group label{flex-basis:50px;flex-shrink:0;text-align:right;font-size:.9em;color:#bbb}
  .control-group input[type=range]{flex-grow:1;cursor:pointer;min-inline-size:100px}
  #tempo-slider{accent-color:#bea28c} /* blue‑cyan */
  #pitch-slider{accent-color:#b48ead} /* green */
  #volume-slider{accent-color:#88c0d0} /* purple */
  .value-display{font-size:.9em;color:#bbb;min-inline-size:60px;text-align:right;white-space:nowrap}

  .controls.disabled{opacity:var(--disabled-opacity);pointer-events:none}
  .error{margin-block-end:10px;padding:8px;border:1px solid var(--error-color);border-radius:4px;
         font-size:.9em;font-weight:bold;color:var(--error-color);
         background-color:color-mix(in srgb,var(--error-color) 10%,transparent)}
  .error:empty{display:none}

  /* — scrollbars — */
  :is(.controls,.reference-panel){scrollbar-width:thin;scrollbar-color:#4c566a #2e3440}
  :is(.controls,.reference-panel)::-webkit-scrollbar{width:8px}
  :is(.controls,.reference-panel)::-webkit-scrollbar-track{background:#2e3440;border-radius:4px}
  :is(.controls,.reference-panel)::-webkit-scrollbar-thumb{background:#4c566a;border-radius:4px;border:2px solid #2e3440}
  :is(.controls,.reference-panel)::-webkit-scrollbar-thumb:hover{background:#5e81ac}

  /* — reference panel — */
  .reference-panel{display:block;width:100%;flex-grow:1;overflow-y:auto;padding:0;
                   background:transparent;border:none;color:#ccc}
  .reference-panel h2{margin:0 0 15px;padding-block-end:5px;border-block-end:1px solid #555;font-size:1.3em;color:#eee}
  .reference-panel h3{margin:15px 0 5px;padding-inline-start:8px;font-size:1.1em;color:#ddd}
  .reference-panel h3:nth-of-type(1){border-inline-start:3px solid #88c0d0;color:#88c0d0}
  .reference-panel h3:nth-of-type(2){border-inline-start:3px solid #bea28c;color:#bea28c}
  .reference-panel h3:nth-of-type(3){border-inline-start:3px solid #b48ead;color:#b48ead}
  .reference-panel h3:nth-of-type(4){border-inline-start:3px solid #d08770;color:#d08770}
  .reference-panel ul{list-style:none;padding-inline-start:10px;margin:0 0 1em}
  .reference-panel li,.reference-panel p{margin-block-end:.7em;font-size:.9em;line-height:1.5;color:#ccc}
  .reference-panel code{font-family:monospace;font-size:.95em;background:#444;color:#f0f0f0;padding:2px 5px;border-radius:3px}
  .reference-panel p em{font-style:italic;color:#aaa}
  .reference-panel p:last-of-type em{display:block;margin-top:15px;font-size:.85em}

  /* — waveform — */
  .waveform-container{
    position:relative;overflow:hidden;flex-shrink:0;
    width:100%;margin-block-end:15px;background:#1e1e1e;
    border:1px solid var(--control-border);border-radius:4px;
  }
  #waveform-canvas{display:block;width:100%;height:60px;background:#222}
  .trim-handle{
    position:absolute;top:0;bottom:0;inline-size:10px;cursor:ew-resize;z-index:10;
    background:rgba(255,107,107,.6);border:1px solid rgba(255,255,255,.7);box-sizing:border-box;
  }
  .trim-handle:hover{background:rgba(255,107,107,.8)}
  .trim-handle-start{left:0;border-inline-end-width:2px;border-inline-start:none;border-radius:3px 0 0 3px}
  .trim-handle-end{left:calc(100% - 10px);border-inline-start-width:2px;border-inline-end:none;border-radius:0 3px 3px 0}
}

/* ---------- UTILITIES / RESPONSIVE -------------------------------- */
@layer utilities {
  @media (max-width:1024px){
    body{overflow:auto;height:auto}
    .main-layout{display:flex;flex-direction:column;height:auto;width:100%;max-inline-size:700px;margin:20px auto;padding:15px;gap:15px}
    :is(.controls-column,.reference-column){inline-size:100%;block-size:auto;max-block-size:none;overflow-y:visible !important;
      transition:none !important;visibility:visible !important;opacity:1 !important}
    :is(.controls-column,.reference-column).hidden{display:none !important;block-size:auto !important}
    .image-area{display:block;position:relative;margin:0 auto 15px;inline-size:90%;max-inline-size:500px;padding-block-end:90%}
    #main-image{position:absolute;inset:0;inline-size:100%;block-size:100%;transform:none}
  }

  @media (max-width:480px){
    body{overflow-x:hidden}
    .main-layout{padding:10px;gap:10px}
    .image-area{inline-size:95%;padding-block-end:95%;margin-block-end:10px}
    h1{font-size:1.2em}
    .control-group{flex-direction:column;align-items:stretch;gap:5px}
    .control-group label{flex-basis:auto;width:100%;text-align:left;margin-block-end:3px}
    .value-display{width:100%;text-align:right;margin-block-start:3px}
    .button-group{flex-direction:column;align-items:stretch}
    button{padding:10px 15px}
    .controls{overflow-y:auto}
  }
}

/* ---------- Add within @layer components or a suitable layer ---------- */

/* Style for clickable shortcut links in reference panel */
.shortcut-link {
    cursor: pointer;
    color: #a3be8c; /* Light green - adjust as desired */
    text-decoration: none; /* Remove default underline from potential role */
    display: inline-block; /* Needed for transform */
     border-bottom: 1px dotted #a3be8c; /* Subtle underline */
}

.shortcut-link:hover,
.shortcut-link:focus {
    color: #ebcb8b; /* Yellowish on hover/focus */
    text-decoration: none; /* Ensure no underline on hover if theme changes */
    outline: 1px dashed #ebcb8b; /* Focus indicator */
    outline-offset: 2px;
     border-bottom-color: #ebcb8b;
}

/* Simple feedback on activation (optional) */
.shortcut-link:active {
    transform: scale(0.95);
    color: #bf616a; /* Reddish feedback */
     border-bottom-color: transparent;
}

/* Style topic headings for better separation */
.reference-panel h3[class^="topic-"] {
    margin-top: 20px;
    padding-left: 8px; /* Reset padding */
    border-left: 3px solid #555; /* Default border */
}
/* Optional: Assign specific colors if desired, overriding generic ones */
.reference-panel h3.topic-waveform { border-left-color: #ff6b6b; color: #ff6b6b; } /* Red for waveform handles */
.reference-panel h3.topic-volume   { border-left-color: #88c0d0; color: #88c0d0; } /* Blue */
.reference-panel h3.topic-tempo    { border-left-color: #bea28c; color: #bea28c; } /* Orange/Brown */
.reference-panel h3.topic-pitch    { border-left-color: #b48ead; color: #b48ead; } /* Purple */
.reference-panel h3.topic-multiplier { border-left-color: #d08770; color: #d08770; } /* Coral */
.reference-panel h3.topic-effects  { border-left-color: #a3be8c; color: #a3be8c; } /* Green */
.reference-panel h3.topic-filter   { border-left-color: #81a1c1; color: #81a1c1; } /* Grey-Blue */
.reference-panel h3.topic-playback { border-left-color: #ebcb8b; color: #ebcb8b; } /* Yellow */