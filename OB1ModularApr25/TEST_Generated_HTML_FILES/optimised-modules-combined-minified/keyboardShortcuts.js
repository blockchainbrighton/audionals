// --- START OF FILE keyboardShortcuts.js ---
import*as audio from"/content/cd4a0c420d69fd9bd62f481eabb372e5be7b7fd4c0766c4778a82f093aec3c2fi0";import*as ui from"/content/4c9ce4ed23eb99654200e353b14643359bbdb69d9289187bd89da6bd0b31350di0";import{clamp,_isInputFocused}from"/content/8e485ab53465925b8a2cf7269ee5a691e0b17e13573c7e500d15b99204776936i0";let tempoRef,pitchRef,volumeRef,multiplierRef,lastVolume=1;const STEPS={TEMPO_SMALL:1,TEMPO_LARGE:10,PITCH_LINEAR:.01,VOLUME:.05},EPS=1e-9,ST_RATIO=Math.pow(2,1/12),MULT_MAP={1:1,2:2,3:3,4:4,5:8,6:16,7:32,8:8};function applyChange(e,t,l,o,i,a=1,u=""){if("function"==typeof t&&"function"==typeof l)try{if(t(o),l(o),e){const t=parseFloat(e.min),l=parseFloat(e.max);isNaN(t)||isNaN(l)||(e.value=clamp(o,t,l))}const r="Multiplier"===i?`x${o}`:1!==a?`${Math.round(o*a)}${u}`:`${o}${u}`,s=i.startsWith("Pitch")?` (Rate: ${o.toFixed(4)})`:"";console.log(`${i} set to: ${r}${s}`)}catch(e){console.error(`applyChange error for ${i}:`,e),ui.showError(`Failed to set ${i}`)}else console.error(`applyChange: invalid setter/updater for ${i}`)}function adjustTempo(e){if(!tempoRef)return;const t=parseInt(tempoRef.value,10),l=parseInt(tempoRef.min,10),o=parseInt(tempoRef.max,10);if([t,l,o].some(isNaN))return console.error("Invalid tempo slider");const i=clamp(t+e,l,o);i!==t&&applyChange(tempoRef,audio.setTempo,ui.updateTempoDisplay,i,"Tempo",1," BPM")}function adjustPitch(e,t=0){if(!pitchRef)return;const l=parseFloat(pitchRef.value),o=parseFloat(pitchRef.min),i=parseFloat(pitchRef.max);if([l,o,i].some(isNaN))return console.error("Invalid pitch slider");let a,u;switch(e){case"linear":a=clamp(l+t,o,i),u="Pitch (Linear)";break;case"semitone":a=clamp(l*(t>0?ST_RATIO:1/ST_RATIO),o,i),u=`Pitch (${t>0?"+1":"-1"} ST)`;break;case"mult":a=clamp(l*t,o,i),u="Pitch (Mult)";break;case"reset":a=clamp(1,o,i),u="Pitch Reset";break;default:return}Math.abs(a-l)>EPS&&applyChange(pitchRef,audio.setGlobalPitch,ui.updatePitchDisplay,a,u,100,"%")}function adjustVolume(e){if(!volumeRef)return;const t=parseFloat(volumeRef.value),l=parseFloat(volumeRef.min),o=parseFloat(volumeRef.max);if([t,l,o].some(isNaN))return console.error("Invalid volume slider");const i=clamp(t+e,l,o);Math.abs(i-t)>EPS&&(i>l&&(lastVolume=i),applyChange(volumeRef,audio.setVolume,ui.updateVolumeDisplay,i,"Volume",100,"%"))}function toggleMute(){if(!volumeRef)return;const e=parseFloat(volumeRef.value),t=parseFloat(volumeRef.min),l=parseFloat(volumeRef.max);if([e,t,l].some(isNaN))return console.error("Invalid volume slider");let o,i;e>t+EPS?(lastVolume=e,o=t,i="Mute"):(o=clamp(lastVolume>t?lastVolume:l,t,l),i="Unmute"),Math.abs(o-e)>EPS&&applyChange(volumeRef,audio.setVolume,ui.updateVolumeDisplay,o,i,100,"%")}function setMultiplier(e){const t=MULT_MAP[e];if(!t||"function"!=typeof audio.setScheduleMultiplier)return;(audio.getScheduleMultiplier?.()||1)!==t&&applyChange(multiplierRef,audio.setScheduleMultiplier,ui.updateScheduleMultiplierDisplay,t,"Multiplier")}function handleKey(e){if(_isInputFocused(e.target))return;const{shiftKey:t,ctrlKey:l,metaKey:o,altKey:i,key:a}=e,u=l||o;let r=!1;u&&t&&!i?(["=","+"].includes(a)&&(adjustTempo(STEPS.TEMPO_LARGE),r=!0),["-","_"].includes(a)&&(adjustTempo(-STEPS.TEMPO_LARGE),r=!0),["]","}"].includes(a)&&(adjustPitch("semitone",1),r=!0),["[","{"].includes(a)&&(adjustPitch("semitone",-1),r=!0)):!t||u||i?t||u||i||("="===a&&(adjustPitch("mult",2),r=!0),"-"===a&&(adjustPitch("mult",.5),r=!0),"0"===a&&(adjustPitch("reset"),r=!0),"ArrowUp"===a&&(adjustVolume(STEPS.VOLUME),r=!0),"ArrowDown"===a&&(adjustVolume(-STEPS.VOLUME),r=!0),/[mM]/.test(a)&&(toggleMute(),r=!0),MULT_MAP[a]&&(setMultiplier(a),r=!0)):(["=","+"].includes(a)&&(adjustTempo(STEPS.TEMPO_SMALL),r=!0),["-","_"].includes(a)&&(adjustTempo(-STEPS.TEMPO_SMALL),r=!0),["]","}"].includes(a)&&(adjustPitch("linear",STEPS.PITCH_LINEAR),r=!0),["[","{"].includes(a)&&(adjustPitch("linear",-STEPS.PITCH_LINEAR),r=!0)),r&&e.preventDefault()}export function init({tempoSlider:e,pitchSlider:t,volumeSlider:l,multiplierSlider:o}){if(![e,t,l,o].every((e=>e instanceof HTMLInputElement)))return console.error("Invalid slider refs:",{tempoSlider:e,pitchSlider:t,volumeSlider:l,multiplierSlider:o}),void(tempoRef=pitchRef=volumeRef=multiplierRef=null);[tempoRef,pitchRef,volumeRef,multiplierRef]=[e,t,l,o],lastVolume=parseFloat(volumeRef.value)||lastVolume,document.addEventListener("keydown",handleKey),console.log("Keyboard shortcuts initialized.")}export function destroy(){document.removeEventListener("keydown",handleKey),tempoRef=pitchRef=volumeRef=multiplierRef=null,console.log("Keyboard shortcuts destroyed.")}