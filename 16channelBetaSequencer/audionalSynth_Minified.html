<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Korg MS10 Emulator</title><style>body{font-family:Arial,sans-serif;background-color:#2d2d2d;color:#efefef;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:40vw;margin:20px;box-sizing:border-box;background-image:linear-gradient(to top,#2d2d2d,#434343)}.synth-container{background-color:#4a4a4a;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,150,255,.5);max-height:calc(100vh - 40px);overflow-y:auto;box-sizing:border-box;width:calc(100% - 40px);text-align:center}button{background-color:#2d2d2d;color:#0fafff;border:none;padding:5px 20px;border-radius:5px;cursor:pointer;outline:0;transition:background-color .3s;display:inline-block;width:auto;box-sizing:border-box;margin-right:10px}button:last-child{margin-right:0}button:hover{background-color:#0fafff;color:#2d2d2d}label{display:block;margin:10px 0}input[type=range]{width:100%}.controls-row{display:flex;justify-content:center;align-items:center;margin-bottom:20px}.controls-row>*{margin-right:15px}.controls-row>:last-child{margin-right:0}.control-pair{display:flex;justify-content:center;align-items:center;margin-bottom:15px}.control-pair>*{margin-right:15px}.control-pair>:last-child{margin-right:0}#arpNotesDisplay,#timingAdjust,label[for=timingAdjust]{margin:5px 0}.timing-section{margin-bottom:5px}.buttons-section button,.buttons-section label{margin-top:0;margin-bottom:0}.buttons-section{margin-top:5px}#arpNotesDisplay{display:block;margin:10px auto}</style><div class=synth-container><h2>Audional Synth</h2><div class=controls-row><label>Note:<select id=note></select></label><label>Waveform:<select id=waveform><option value=sawtooth selected>Sawtooth<option value=square>Square<option value=triangle>Triangle<option value=pulse>Pulse</select></label><button onclick=playMS10TriangleBass()>Play Note</button></div><label>Attack (ms): <input id=attack type=range value=10 max=2000 min=0></label><label>Release (ms): <input id=release type=range value=500 max=2000 min=0></label><label>Cutoff (Hz): <input id=cutoff type=range value=2000 max=2000 min=20></label><label>Resonance: <input id=resonance type=range value=5 max=10 min=0 step=0.1></label><label>Volume: <input id=volume type=range value=100 max=100 min=0></label><div class=arpeggiator-controls><h3>Arpeggiator</h3><button id=arpToggle>Create Note Array</button> <button id=playArp>Play Arp</button> <button id=pauseArp>Pause Arp</button><button id=addRest>Add Rest</button><div class=control-pair><label>Tempo (BPM): <input id=arpTempo type=number value=105 max=240 min=40 step=0.1></label><label for=bpmAdjustValue>Fine Tuning (+/- BPM): <input id=bpmAdjustValue type=number value=0.5 max=10 min=-10 step=0.1></label></div><div class=control-pair><label>Pattern:<select id=arpPattern><option value=up>Up<option value=down>Down<option value=random>Random<option value=up-down>Up-Down<option value=double-step>Double Step<option value=random-rest>Random with Rests</select></label><label>Speed:<select id=arpSpeed><option value=half-time>Half Time<option value=normal selected>Normal<option value=double-time>Double Time<option value=quadruple-time>Quadruple Time<option value=octuple-time>Octuple Time</select></label></div><div class=buttons-section><label><input id=useSequencerTiming type=checkbox value=useSequencerTiming> Use Sequencer Timing</label><button onclick=saveSettings()>Save Settings</button> <button onclick=loadSettings()>Load Settings</button></div><div class=timing-section><label for=timingAdjust>Sync Nudge (+/- 10%):</label><input id=timingAdjust type=range value=0 max=10 min=-10 onmouseup=resetTimingAdjust()><canvas height=60 id=arpNotesDisplay width=300></canvas></div>
    <script>
let expectedNextStepTime=null,simulatedSequencerTimeout=null,nextSimulatedSequencerTime=null,isSimulatedMode=!0,simulatedCurrentStep=0,isSimulatorRunning=!1,isExternalModeActive=!1,externalStepTimeout=null,isArpeggiatorOn=!1,arpNotes=[],currentArpIndex=0,arpTimeout=null,nudgeApplied=!1,isNudgeActive=!1,context=new(window.AudioContext||window.webkitAudioContext),currentOscillator=null;function playMS10TriangleBass(e=null){currentOscillator&&(currentOscillator.stop(),currentOscillator=null);let t=context.createOscillator(),n=context.createGain(),o=context.createBiquadFilter(),r=document.getElementById("waveform").value;if(t.type=r,null===e&&(e=parseFloat(document.getElementById("note").value),!isFinite(e)))return void console.error("Invalid frequency value:",e);t.frequency.setValueAtTime(e,context.currentTime);let a=document.getElementById("attack").value/1e3,l=document.getElementById("release").value/1e3,i=document.getElementById("cutoff").value,u=document.getElementById("resonance").value;o.type="lowpass",o.frequency.value=i,o.Q.value=u,n.gain.setValueAtTime(0,context.currentTime);const c=getVolume();n.gain.linearRampToValueAtTime(2*c,context.currentTime+a),n.gain.linearRampToValueAtTime(0,context.currentTime+a+l),t.connect(o),o.connect(n),n.connect(context.destination),t.start(),t.stop(context.currentTime+a+l),currentOscillator=t}let nextNoteTime=context.currentTime;const A4_MIDI_NUMBER=69,A4_FREQUENCY=440,arpNoteNames=[];function onMIDISuccess(e){let t=e.inputs.values();for(let e=t.next();e&&!e.done;e=t.next())e.value.onmidimessage=onMIDIMessage}function onMIDIFailure(){console.warn("Could not access your MIDI devices.")}function onMIDIMessage(e){console.log("Received MIDI message:",e.data);let t=240&e.data[0],n=e.data[1],o=e.data.length>2?e.data[2]:0;switch(t){case 144:if(o>0){let e=midiNoteToFrequency(n);console.log(`Note On. MIDI note: ${n}, Frequency: ${e}`),isArpeggiatorOn?(arpNotes.push(e),updateArpNotesDisplay()):playMS10TriangleBass(e,o/127)}break;case 128:if(console.log(`Note Off. MIDI note: ${n}`),isArpeggiatorOn){let e=midiNoteToFrequency(n),t=arpNotes.indexOf(e);-1!==t&&arpNotes.splice(t,1)}break;default:console.log(`Unhandled MIDI message type: ${t}`)}}function midiNoteToFrequency(e){return e<0||e>127?(console.error("Invalid MIDI note:",e),null):Math.pow(2,(e-A4_MIDI_NUMBER)/12)*A4_FREQUENCY}function playNote(e,t=1){playMS10TriangleBass(440*Math.pow(2,(e-69)/12),t)}function stopNote(e){}function getVolume(){return document.getElementById("volume").value/100}function populateNoteSelector(){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];window.noteNameToFrequency=function(t,n){const o=e.indexOf(t)+12*(n+1);return 440*Math.pow(2,(o-69)/12)},window.frequencyToNoteName=function(t){let n=Math.round(12*Math.log2(t/440)+69);return e[n%12]+(Math.floor(n/12)-1)};let t=0,n=0;const o=document.getElementById("note");for(let e=0;e<88;e++){const r=document.createElement("option"),a=noteNames[t],l=440*Math.pow(2,(e-49)/12);r.value=l,r.textContent=a+n,o.appendChild(r),t++,t>=12&&(t=0,n++)}}function startArpeggiator(){isArpeggiatorOn=!0,playArpNotes()}function playArpeggiator(){startArpeggiator()}function stopArpeggiator(){isArpeggiatorOn=!1,arpNotes.length=0}function playArpNotes(){if(console.log("[playArpNotes] Function called."),isArpeggiatorOn&&arpNotes.length>0){if(console.log("[playArpNotes] Arpeggiator is on and arpNotes are present."),isExternalModeActive)return void console.log("[playArpNotes] isExternalModeActive value:",isExternalModeActive);null!==arpNotes[currentArpIndex]&&(console.log("[playArpNotes] Playing note at current index:",currentArpIndex,"Note:",arpNotes[currentArpIndex]),playMS10TriangleBass(arpNotes[currentArpIndex]));let e=document.getElementById("arpPattern").value;console.log("[playArpNotes] Arpeggiator pattern:",e);let t=60/parseFloat(document.getElementById("arpTempo").value)*1e3;switch(console.log("[playArpNotes] Base interval (ms):",t),e){case"up":incrementArpIndex();break;case"down":decrementArpIndex();break;case"random":randomizeArpIndex();break;case"up-down":upDownArpIndex();break;case"double-step":doubleStepArpIndex();break;case"random-rest":randomWithRestsArpIndex();break;default:console.error("Unknown arpeggiator pattern:",e)}console.log("[playArpNotes] New arp index after pattern modification:",currentArpIndex),t=applySpeedModifier(t),console.log("[playArpNotes] Base interval after speed modifier (ms):",t);let n=t;if(isNudgeActive){t*=1-parseFloat(document.getElementById("timingAdjust").value)/100,console.log("[playArpNotes] Adjusted interval due to active nudge (ms):",t)}let o=context.currentTime+n/1e3;console.log("[playArpNotes] Scheduled time (in context time):",o),arpTimeout=setTimeout((()=>{nudgeApplied=!1,console.log("[playArpNotes] Timeout triggered. Calling playArpNotes again."),playArpNotes()}),n)}else console.log("[playArpNotes] Arpeggiator is off or arpNotes is empty.");updateArpNotesDisplay()}function applySpeedModifier(e){let t=document.getElementById("arpSpeed").value;switch(t){case"normal":return e;case"double-time":return e/2;case"half-time":return 2*e;case"quadruple-time":return e/4;case"octuple-time":return e/8;default:return console.error("Unknown speed setting:",t),e}}function incrementArpIndex(){currentArpIndex=(currentArpIndex+1)%arpNotes.length}function decrementArpIndex(){currentArpIndex=(currentArpIndex-1+arpNotes.length)%arpNotes.length}function randomizeArpIndex(){currentArpIndex=Math.floor(Math.random()*arpNotes.length)}navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(onMIDISuccess,onMIDIFailure):console.warn("WebMIDI is not supported in this browser."),document.addEventListener("DOMContentLoaded",populateNoteSelector);let goingUp=!0;function upDownArpIndex(){goingUp?(incrementArpIndex(),currentArpIndex===arpNotes.length-1&&(goingUp=!1)):(decrementArpIndex(),0===currentArpIndex&&(goingUp=!0))}function doubleStepArpIndex(){currentArpIndex=(currentArpIndex+2)%arpNotes.length}function randomWithRestsArpIndex(){Math.random()>.8||randomizeArpIndex()}function pauseArpeggiator(){clearTimeout(arpTimeout),isArpeggiatorOn=!1}function resetTimingAdjust(){document.getElementById("timingAdjust").value=0}function updateArpNotesDisplay(){const e=document.getElementById("arpNotesDisplay"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.font="bold 11px Arial",t.fillStyle="#FFFFFF";const n=t.measureText("W#").width+7;let o=10,r=30,a=0;arpNotes.forEach((l=>{let i=null!==l?frequencyToNoteName(l):"Rest";o+n>e.width&&(a=0,o=10,r+=30),t.fillText(i,o,r),a++,a>=16?(a=0,o=10,r+=30):o+=n}))}function toggleArpeggiator(){const e=document.getElementById("arpToggle");isArpeggiatorOn?(e.innerText="Create Note Array",stopArpeggiator()):(e.innerText="Stop Arpeggiator",startArpeggiator())}const keyToMidiNote={},noteNames=["A","W","S","E","D","F","T","G","Y","H","U","J","K","O","L","P"],startingMidiNote=21;for(let e=0;e<noteNames.length;e++)keyToMidiNote["Key"+noteNames[e]]=21+e;document.addEventListener("keydown",(function(e){const t=keyToMidiNote[e.code];if(t){const n=440*Math.pow(2,(t-69)/12);console.log(`[KEYDOWN] Key: ${e.code}, MIDI note: ${t}, Frequency: ${n}`),playMS10TriangleBass(n),arpNotes.push(n),updateArpNotesDisplay()}})),document.addEventListener("keyup",(function(e){const t=keyToMidiNote[e.code];t&&(console.log(`[KEYUP] Key: ${e.code}, MIDI note: ${t}`),stopMS10TriangleBass())})),document.getElementById("arpToggle").addEventListener("click",toggleArpeggiator),document.getElementById("playArp").addEventListener("click",playArpeggiator),document.getElementById("pauseArp").addEventListener("click",pauseArpeggiator);let previousTimestamp=null,sequencerBPM=null;function onSequencerStep(e){const t=Date.now();if(null!==previousTimestamp){const e=6e4/(t-previousTimestamp)/4;bpmBuffer.push(e),bpmBuffer.length>bpmBufferSize&&bpmBuffer.shift();const n=bpmBuffer.reduce(((e,t)=>e+t),0)/bpmBuffer.length;document.getElementById("useSequencerTiming").checked&&adjustArpeggiatorTiming(n)}Math.abs(Date.now()-expectedNextStepTime)<10&&(currentArpIndex=0),previousTimestamp=t}function adjustArpeggiatorTiming(e){if(isNudgeActive){e*=1+parseFloat(document.getElementById("timingAdjust").value)/100}e+=parseFloat(document.getElementById("bpmAdjustValue").value),document.getElementById("arpTempo").value=e.toFixed(1);const t=6e4/e/4;expectedNextStepTime=Date.now()+t}const bpmBuffer=[],bpmBufferSize=100;function onSequencerStep(e){const t=Date.now();if(null!==previousTimestamp){const e=6e4/(t-previousTimestamp)/4;bpmBuffer.push(e),bpmBuffer.length>bpmBufferSize&&bpmBuffer.shift();const n=bpmBuffer.reduce(((e,t)=>e+t),0)/bpmBuffer.length;document.getElementById("useSequencerTiming").checked&&adjustArpeggiatorTiming(n)}previousTimestamp=t}const sequencerChannel=new BroadcastChannel("sequencerChannel");function saveSettings(){const e={note:document.getElementById("note").value,waveform:document.getElementById("waveform").value,attack:document.getElementById("attack").value,release:document.getElementById("release").value,cutoff:document.getElementById("cutoff").value,resonance:document.getElementById("resonance").value,volume:document.getElementById("volume").value,arpTempo:document.getElementById("arpTempo").value,arpPattern:document.getElementById("arpPattern").value,arpNotes:arpNotes},t=JSON.stringify(e),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="synth_settings.json",r.click()}function loadSettings(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=e=>{const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){const t=JSON.parse(e.target.result);document.getElementById("note").value=t.note,document.getElementById("waveform").value=t.waveform,document.getElementById("attack").value=t.attack,document.getElementById("release").value=t.release,document.getElementById("cutoff").value=t.cutoff,document.getElementById("resonance").value=t.resonance,document.getElementById("volume").value=t.volume,document.getElementById("arpTempo").value=t.arpTempo,document.getElementById("arpPattern").value=t.arpPattern,t.arpNotes&&(arpNotes=t.arpNotes,updateArpNotesDisplay())},n.readAsText(t)},e.click()}sequencerChannel.addEventListener("message",(e=>{"step"===e.data.type&&(console.log(`[ms10 messageEventListener] Received step: ${e.data.data.step}`),onSequencerStep(e.data.data.step),externalStepTimeout&&clearTimeout(externalStepTimeout),externalStepTimeout=setTimeout((()=>{console.log("[ms10] No external steps received for an extended period. Stopping arpeggiator."),stopArpeggiator()}),250))})),document.getElementById("addRest").addEventListener("click",(function(){arpNotes.push(null),updateArpNotesDisplay()})),document.getElementById("timingAdjust").addEventListener("input",(function(){isNudgeActive=!0})),document.getElementById("timingAdjust").addEventListener("change",(function(){isNudgeActive=!1}));
function stopMS10TriangleBass() {
    if (currentOscillator) {
        currentOscillator.stop();
        currentOscillator = null;
    }
}
</script>
</body>
</html>
