<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>OB1 #1 - Audional Art</title><style>body{background-color:#000000;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}img {width: auto;height: auto;max-width: 60%;max-height: 80vh;object-fit: contain;aspect-ratio: 1 / 1;}
</style></head><body>
<img id="OB1_Image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAIAAABLixI0AAAACXBIWXMAAAAnAAAAJwEqCZFPAAAAI0lEQVQ4jWN81s3JQCXARC2DRs0aNWvUrFGzRs0aNWsYmQUAtP4BrHiSyo4AAAAASUVORK5CYII=" alt="Click to play audio">
<!-- Audio: Short click sound -->
<audio id="audionalData" loop data-audionalSampleName="808 Kick Drum">
<source src="data:audio/wav;base64,UklGRhowAABXQVZFZm10IBAAAAABAAEARKwAABCxAgAEABAAZGF0YUwAAAACAAACABgAZGF0YQAAAAEAkZAgIIEyHjAqeykAAAAA//uQZAUABfQU8WkMAAAAAHHVUUU5VZmUId2luZwAAAAAA//uQZAUABfQU8WkMAAAAAHHVUUU5VZmUId2luZwAAAAAA//uQZAMABfQU8WkMAAAAAHHVUUU5VZmUId2luZwAAAAAA" type="audio/wav">
Your browser does not support the audio element.
</audio>
<div id= "BPM">78 BPM</div> 
<style>
#BPM {font-size: 24px;font-weight: bold;color: rgb(255, 251, 0);position: absolute;top: 5%;left: 50%;transform: translate(-50%, -50%);opacity: 0;transition: opacity 0.5s ease-in-out;}#BPM.show {opacity: 1;}@keyframes shake-all-directions {0%, 100% {transform: translate(0);}10% {transform: translate(-5px, -5px);}20% {transform: translate(5px, -5px);}30% {transform: translate(-5px, 5px);}40% {transform: translate(5px, 5px);}50% {transform: translate(-5px, -5px);}60% {transform: translate(5px, 5px);}70% {transform: translate(-5px, 5px);}80% {transform: translate(5px, -5px);}90% {transform: translate(-5px, -5px);}}.shake-all-directions-animation {animation: shake-all-directions 0.15s cubic-bezier(.36,.07,.19,.97) both infinite;}
</style>
<script>
const audioContext=new(window.AudioContext||window.webkitAudioContext),gainNode=audioContext.createGain();gainNode.connect(audioContext.destination),gainNode.gain.value=1;let multiplierCount=0,isMuted=!1,previousVolume=1,beatCounter=0,isFadingOut=!1;const state={bpm:78,isLooping:!1,audioBuffer:null,nextNoteTime:audioContext.currentTime,scheduledNotes:[],scheduleMultiplier:1};function sendCurrentSettings(){console.log("Sending current settings back to parent:",{volume:gainNode.gain.value,scheduleMultiplier:state.scheduleMultiplier}),event.source.postMessage({type:"currentSettings",settings:{volume:gainNode.gain.value,scheduleMultiplier:state.scheduleMultiplier}},"*")}function playSampleOnce(){const e=createAndConnectBufferSource(state.audioBuffer);startAnimation("OB1_Image"),e.start(),e.onended=()=>{stopAnimation("OB1_Image")}}async function fetchAndDecodeAudio(e){console.log(`[fetchAndDecodeAudio] Fetching audio for element: ${e}`);const t=document.getElementById(e);if(!t)return console.error("Audio element not found:",e);const n=t.querySelector("source")?.src||t.src;if(!n)return console.error("Audio source not found for element:",e);try{const e=await(await fetch(n)).arrayBuffer();audioContext.decodeAudioData(e,(e=>{state.audioBuffer=e,console.log("[fetchAndDecodeAudio] Audio data fetched and decoded successfully.")}),(e=>console.error("Error decoding audio data:",e)))}catch(e){console.error("Error fetching audio data:",e)}}function scheduleNextNote(){if(!state.isLooping||!state.audioBuffer)return;const e=audioContext.currentTime;e>=state.nextNoteTime&&(playNote(),console.log(`Beat ${++beatCounter}: Scheduled at ${state.nextNoteTime.toFixed(3)} seconds.`),state.nextNoteTime+=calculateBeatDuration(state.bpm)/state.scheduleMultiplier);const t=Math.max(1e3*(state.nextNoteTime-e),10);setTimeout(scheduleNextNote,t)}function playNote(){const e=createAndConnectBufferSource(state.audioBuffer);startAnimation("OB1_Image"),e.start(audioContext.currentTime),e.onended=()=>{setTimeout((()=>{stopAnimation("OB1_Image")}),150),e.disconnect()},state.scheduledNotes.push(e)}function createAndConnectBufferSource(e){const t=audioContext.createBufferSource();return t.buffer=e,t.connect(gainNode),t}function playAudioBuffer(){state.isLooping||(state.isLooping=!0,state.startTime=state.nextNoteTime=audioContext.currentTime,scheduleNextNote())}function stopAudioPlayback(){state.isLooping&&(state.isLooping=!1,fadeOutAndStopSources())}function fadeOutAndStopSources(){if(isFadingOut)return;isFadingOut=!0;const e=audioContext.currentTime;gainNode.gain.setValueAtTime(gainNode.gain.value,e),gainNode.gain.linearRampToValueAtTime(0,e+.1),setTimeout((()=>{state.scheduledNotes.forEach((e=>{e.stop(),e.disconnect()})),state.scheduledNotes=[],gainNode.gain.cancelScheduledValues(audioContext.currentTime),gainNode.gain.setValueAtTime(.5,audioContext.currentTime),isFadingOut=!1}),100)}function calculateBeatDuration(e){return 60/e}function updateBPM(e){console.log(`Updating BPM to ${e}`),state.bpm=e,adjustPlaybackTimingBasedOnBPM(),displayUpdate("BPM",`${e} BPM`)}function adjustPlaybackTimingBasedOnBPM(){const e=60/state.bpm;state.nextNoteTime=audioContext.currentTime+e,state.isLooping&&(stopAudioPlayback(),playAudioBuffer())}function displayUpdate(e,t,n=3e3){const o=document.getElementById(e);o.textContent=t.startsWith("Multiplier:")?calculateDisplayTextForMultiplier(t.split(": ")[1]):t,o.classList.add("show"),setTimeout((()=>o.classList.remove("show")),n)}function calculateDisplayTextForMultiplier(e){const t=parseFloat(e);return 1!==t?t>1?`x${t}`:"1/"+1/t:"1:1"}window.addEventListener("message",(e=>{const{type:t,data:n}=e.data;switch(t){case"updateBPM":updateBPM(Math.max(60,Math.min(240,n.bpm)));break;case"muteControl":applyVolumeFade(n.mute?0:previousVolume,audioContext.currentTime,.03);break;case"requestSettings":sendCurrentSettings();break;default:console.log("Unknown message type:",t)}})),document.addEventListener("DOMContentLoaded",(()=>fetchAndDecodeAudio("audionalData"))),document.getElementById("OB1_Image").addEventListener("click",(async()=>{"suspended"===audioContext.state&&await audioContext.resume();const e=state.isLooping?"STOP":"START";console.log(`[Click Event] Looping state: ${e}`),state.isLooping?stopAudioPlayback():playAudioBuffer()})),document.addEventListener("keydown",(e=>{" "!==e.key&&32!==e.keyCode||playSampleOnce()})),document.addEventListener("bpmChange",(e=>{updateBPM(state.bpm+e.detail.adjustment)})),document.addEventListener("multiplierChange",(e=>{state.scheduleMultiplier=1!==e.detail.multiplier?Math.max(1/32,Math.min(32,state.scheduleMultiplier*e.detail.multiplier)):1,console.log(`Multiplier adjusted: ${state.scheduleMultiplier}`),displayUpdate("BPM",`Multiplier: ${state.scheduleMultiplier.toFixed(2)}`)}));let animationTimeoutId=null;function startAnimation(e){const t=document.getElementById(e);t&&(t.classList.add("shake-all-directions-animation"),animationTimeoutId&&(clearTimeout(animationTimeoutId),animationTimeoutId=null),animationTimeoutId=setTimeout((()=>{t.classList.remove("shake-all-directions-animation"),animationTimeoutId=null}),150))}function stopAnimation(e){const t=document.getElementById(e);t&&t.classList.remove("shake-all-directions-animation")}function handleKeyDownEvent(e){const t=audioContext.currentTime;adjustControls(e),adjustVolumeAndToggleMute(e,t,.03)}function dispatchEvent(e,t){const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}function adjustControls(e){if("+"===e.key&&e.shiftKey&&!e.ctrlKey?dispatchEvent("bpmChange",{adjustment:1}):"_"===e.key&&e.shiftKey&&!e.ctrlKey?dispatchEvent("bpmChange",{adjustment:-1}):"="===e.key&&e.shiftKey&&e.ctrlKey?dispatchEvent("bpmChange",{adjustment:10}):"_"===e.key&&e.shiftKey&&e.ctrlKey&&dispatchEvent("bpmChange",{adjustment:-10}),"="!==e.key&&"-"!==e.key||e.shiftKey||e.ctrlKey)"0"!==e.key||e.shiftKey||e.ctrlKey||(dispatchEvent("multiplierChange",{multiplier:1}),console.log("Resetting multiplier to initial value: 1"));else{const t="="===e.key?2:.5;dispatchEvent("multiplierChange",{multiplier:t}),console.log(`Dispatching multiplierChange event, multiplier: ${t}`)}}function adjustVolumeAndToggleMute(e,t,n){if(","!==e.key&&"."!==e.key||e.shiftKey||e.ctrlKey){if("m"===e.key&&!e.shiftKey&&!e.ctrlKey){isMuted=!isMuted;applyVolumeFade(isMuted?0:previousVolume,t,n),console.log(isMuted?"Muted":"Unmuted")}}else{const o=","===e.key?-.1:.1,i=Math.min(2,Math.max(0,gainNode.gain.value+o));previousVolume=i,applyVolumeFade(i,t,n)}}function applyVolumeFade(e,t,n){gainNode.gain.setValueAtTime(gainNode.gain.value,t),gainNode.gain.linearRampToValueAtTime(e,t+n),console.log(`Volume adjusted, target gain: ${e}`)}document.addEventListener("keydown",handleKeyDownEvent);
</script>
</body>
</html>

