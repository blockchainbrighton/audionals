var app=function(t){"use strict";function n(){}function e(t){return t()}function o(){return Object.create(null)}function i(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function s(t,...e){if(null==t)return n;const o=t.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}function u(t){let n;return s(t,(t=>n=t))(),n}function a(t,n,e){t.$$.on_destroy.push(s(n,e))}function l(t,n){t.appendChild(n)}function d(t,n,e){t.insertBefore(n,e||null)}function f(t){t.parentNode&&t.parentNode.removeChild(t)}function h(t){return document.createElement(t)}function p(){return t=" ",document.createTextNode(t);var t}function m(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function g(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function $(t){return""===t?null:+t}function x(t,n){t.value=null==n?"":n}function w(t,n,e,o){null==e?t.style.removeProperty(n):t.style.setProperty(n,e,o?"important":"")}function b(t,n,e){t.classList[e?"add":"remove"](n)}let y;function v(t){y=t}function S(){if(!y)throw new Error("Function called outside component initialization");return y}const _=[],k=[];let C=[];const E=[],T=Promise.resolve();let A=!1;function j(t){C.push(t)}const O=new Set;let I=0;function q(){if(0!==I)return;const t=y;do{try{for(;I<_.length;){const t=_[I];I++,v(t),D(t.$$)}}catch(t){throw _.length=0,I=0,t}for(v(null),_.length=0,I=0;k.length;)k.pop()();for(let t=0;t<C.length;t+=1){const n=C[t];O.has(n)||(O.add(n),n())}C.length=0}while(_.length);for(;E.length;)E.pop()();A=!1,O.clear(),v(t)}function D(t){if(null!==t.fragment){t.update(),i(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(j)}}const P=new Set;let U;function F(t,n){t&&t.i&&(P.delete(t),t.i(n))}function M(t,n,o,c){const{fragment:s,after_update:u}=t.$$;s&&s.m(n,o),c||j((()=>{const n=t.$$.on_mount.map(e).filter(r);t.$$.on_destroy?t.$$.on_destroy.push(...n):i(n),t.$$.on_mount=[]})),u.forEach(j)}function N(t,n){const e=t.$$;null!==e.fragment&&(!function(t){const n=[],e=[];C.forEach((o=>-1===t.indexOf(o)?n.push(o):e.push(o))),e.forEach((t=>t())),C=n}(e.after_update),i(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function L(t,n){-1===t.$$.dirty[0]&&(_.push(t),A||(A=!0,T.then(q)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function z(t,e,r,c,s,u,a,l=[-1]){const d=y;v(t);const h=t.$$={fragment:null,ctx:[],props:u,update:n,not_equal:s,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:o(),dirty:l,skip_bound:!1,root:e.target||d.$$.root};a&&a(h.root);let p=!1;if(h.ctx=r?r(t,e.props||{},((n,e,...o)=>{const i=o.length?o[0]:e;return h.ctx&&s(h.ctx[n],h.ctx[n]=i)&&(!h.skip_bound&&h.bound[n]&&h.bound[n](i),p&&L(t,n)),e})):[],h.update(),p=!0,i(h.before_update),h.fragment=!!c&&c(h.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);h.fragment&&h.fragment.l(t),t.forEach(f)}else h.fragment&&h.fragment.c();e.intro&&F(t.$$.fragment),M(t,e.target,e.anchor,e.customElement),q()}v(d)}class B{$destroy(){N(this,1),this.$destroy=n}$on(t,e){if(!r(e))return n;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(e),()=>{const t=o.indexOf(e);-1!==t&&o.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const R=[];function V(t,e=n){let o;const i=new Set;function r(n){if(c(t,n)&&(t=n,o)){const n=!R.length;for(const n of i)n[1](),R.push(n,t);if(n){for(let t=0;t<R.length;t+=2)R[t][0](R[t+1]);R.length=0}}}return{set:r,update:function(n){r(n(t))},subscribe:function(c,s=n){const u=[c,s];return i.add(u),1===i.size&&(o=e(r)||n),c(t),()=>{i.delete(u),0===i.size&&o&&(o(),o=null)}}}}function J(t){let e,o,r,c,s,u,a,$,y,v,S,_,k,C,E,T,A,j,O,I,q,D,P,U,F,M;return{c(){e=h("h1"),e.textContent="Audio Trimmer",o=p(),r=h("input"),c=p(),s=h("button"),s.textContent="Load Sample",u=p(),a=h("div"),$=h("canvas"),y=p(),v=h("canvas"),S=p(),_=h("div"),k=p(),C=h("div"),E=p(),T=h("input"),A=p(),j=h("input"),O=p(),I=h("button"),I.textContent="Play",q=p(),D=h("button"),D.textContent="Stop",P=p(),U=h("button"),U.textContent="Loop Selection",g(r,"type","text"),g(r,"placeholder","Enter Ordinal ID"),g($,"width","4000"),g($,"height","800"),g($,"class","waveform-canvas svelte-14j8dif"),g(v,"width","4000"),g(v,"height","800"),g(v,"class","playback-canvas svelte-14j8dif"),g(_,"class","dimmed svelte-14j8dif"),w(_,"width",t[5]),w(_,"left","0"),g(C,"class","dimmed svelte-14j8dif"),w(C,"width",t[6]),w(C,"right","0"),w(C,"left","auto"),g(a,"class","waveform-container svelte-14j8dif"),g(T,"type","range"),g(T,"class","slider svelte-14j8dif"),g(T,"min","0"),g(T,"max",t[0]),g(T,"step","0.01"),g(j,"type","range"),g(j,"class","slider svelte-14j8dif"),g(j,"min","0"),g(j,"max",t[0]),g(j,"step","0.01"),g(U,"class","loop-button svelte-14j8dif"),b(U,"off",!t[3]),b(U,"on",t[3])},m(n,i){d(n,e,i),d(n,o,i),d(n,r,i),x(r,t[4]),d(n,c,i),d(n,s,i),d(n,u,i),d(n,a,i),l(a,$),t[20]($),l(a,y),l(a,v),t[21](v),l(a,S),l(a,_),l(a,k),l(a,C),d(n,E,i),d(n,T,i),x(T,t[2]),d(n,A,i),d(n,j,i),x(j,t[1]),d(n,O,i),d(n,I,i),d(n,q,i),d(n,D,i),d(n,P,i),d(n,U,i),F||(M=[m(r,"input",t[19]),m(s,"click",t[11]),m(T,"change",t[22]),m(T,"input",t[22]),m(j,"change",t[23]),m(j,"input",t[23]),m(I,"click",t[13]),m(D,"click",t[14]),m(U,"click",t[12])],F=!0)},p(t,n){16&n[0]&&r.value!==t[4]&&x(r,t[4]),32&n[0]&&w(_,"width",t[5]),64&n[0]&&w(C,"width",t[6]),1&n[0]&&g(T,"max",t[0]),4&n[0]&&x(T,t[2]),1&n[0]&&g(j,"max",t[0]),2&n[0]&&x(j,t[1]),8&n[0]&&b(U,"off",!t[3]),8&n[0]&&b(U,"on",t[3])},i:n,o:n,d(n){n&&f(e),n&&f(o),n&&f(r),n&&f(c),n&&f(s),n&&f(u),n&&f(a),t[20](null),t[21](null),n&&f(E),n&&f(T),n&&f(A),n&&f(j),n&&f(O),n&&f(I),n&&f(q),n&&f(D),n&&f(P),n&&f(U),F=!1,i(M)}}}function W(t,n,e){let o=1,i=-1;for(let r=0;r<e;r++){const e=t[n+r];e<o&&(o=e),e>i&&(i=e)}return{min:o,max:i}}function G(t,n,e){let o,i,{externalOrdinalId:r=""}=n,{externalAudioContext:c}=n,{channelIndex:s}=n;const l=window.UnifiedSequencerSettings,d=V(0);a(t,d,(t=>e(2,i=t)));const f=V(100);a(t,f,(t=>e(1,o=t)));let h,p,m,g,x,w,b,y=!1,v=c||new(window.AudioContext||window.webkitAudioContext),_=!1,C="",E=0,T="0%",A="0%";function j(){window.UnifiedSequencerSettings&&window.UnifiedSequencerSettings.settings?l.settings.masterSettings.trimValues[s]={startTrimTime:u(d).toString(),endTrimTime:u(f).toString()}:console.error("UnifiedSequencerSettings is not initialized")}var O;async function I(t){const n=`https://ordinals.com/content/${t}`;try{const t=await fetch(n),i=t.headers.get("content-type");let r;if(i&&i.includes("application/json")){const n=await t.json();if(!n.audioData)throw new Error("No audioData field in JSON response");r=function(t){const n=atob(t),e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e.buffer}(n.audioData.split(",")[1])}else r=await t.arrayBuffer();e(18,h=await(o=r,new Promise(((t,n)=>{v.decodeAudioData(o,t,(t=>n(new Error(`Decoding audio data failed with error: ${t}`))))})))),d.set(0),f.set(h.duration),function(){if(!h)return;const t=g.width,n=g.height,e=h.getChannelData(0),o=Math.ceil(e.length/t),i=n/2;w.clearRect(0,0,t,n),w.beginPath();for(let n=0;n<t;n++){const{min:t,max:r}=W(e,n*o,o);w.moveTo(n,i*(1+t)),w.lineTo(n,i*(1+r))}w.stroke()}()}catch(t){console.error("Error fetching or decoding audio:",t)}var o}function q(){const t=_?(v.currentTime-m)%h.duration:0,n=x.width,e=x.height;b.clearRect(0,0,n,e);const o=t/h.duration*n;b.beginPath(),b.moveTo(o,0),b.lineTo(o,e),b.strokeStyle="#FF0000",b.lineWidth=2,b.stroke()}function D(){_&&(q(),requestAnimationFrame(D))}return d.subscribe(j),f.subscribe(j),O=()=>{!function(){const t=l.settings.masterSettings.trimValues[s];d.set(parseFloat(t.startTrimTime)),f.set(parseFloat(t.endTrimTime))}(),w=g.getContext("2d"),b=x.getContext("2d")},S().$$.on_mount.push(O),function(t){S().$$.on_destroy.push(t)}((()=>{p&&p.disconnect(),v.close()})),t.$$set=t=>{"externalOrdinalId"in t&&e(15,r=t.externalOrdinalId),"externalAudioContext"in t&&e(16,c=t.externalAudioContext),"channelIndex"in t&&e(17,s=t.channelIndex)},t.$$.update=()=>{32768&t.$$.dirty[0]&&r&&I(r),262151&t.$$.dirty[0]&&h&&(e(0,E=h.duration),e(5,T=100*Math.max(0,i/E)+"%"),e(6,A=100*Math.max(0,1-o/E)+"%"))},[E,o,i,y,C,T,A,g,x,d,f,function(){const t=r||C;t&&I(t)},function(){e(3,y=!y)},function t(){p=v.createBufferSource(),p.buffer=h,p.connect(v.destination);const n=i,e=o;p.loop=y,y&&(p.loopStart=Math.max(0,n),p.loopEnd=Math.min(e,h.duration)),h&&n<e&&(p.start(0,n,e-n),m=v.currentTime-n,_=!0,D()),p.onended=()=>{_=!1,y&&t()}},function(){_&&p&&(p.disconnect(),p=null,_=!1),e(3,y=!1)},r,c,s,h,function(){C=this.value,e(4,C)},function(t){k[t?"unshift":"push"]((()=>{g=t,e(7,g)}))},function(t){k[t?"unshift":"push"]((()=>{x=t,e(8,x)}))},function(){i=$(this.value),d.set(i)},function(){o=$(this.value),f.set(o)}]}class H extends B{constructor(t){super(),z(this,t,G,J,c,{externalOrdinalId:15,externalAudioContext:16,channelIndex:17},null,[-1,-1])}}function K(t){let e,o,i;return o=new H({}),{c(){var t;e=h("main"),(t=o.$$.fragment)&&t.c()},m(t,n){d(t,e,n),M(o,e,null),i=!0},p:n,i(t){i||(F(o.$$.fragment,t),i=!0)},o(t){!function(t,n,e,o){if(t&&t.o){if(P.has(t))return;P.add(t),U.c.push((()=>{P.delete(t),o&&(e&&t.d(1),o())})),t.o(n)}else o&&o()}(o.$$.fragment,t),i=!1},d(t){t&&f(e),N(o)}}}window.UnifiedSequencerSettings=new t;return new class extends B{constructor(t){super(),z(this,t,null,K,c,{})}}({target:document.body})}(UnifiedSequencerSettings);
//# sourceMappingURL=bundle.js.map
