class OscHotkeys extends HTMLElement{static get observedAttributes(){return["disabled"]}constructor(){super(),this.attachShadow({mode:"open"}).innerHTML="<style>:host{display:none}</style>",this._enabled=!0,this._config={humKey:"hum",shapes:[]},this._downKeys=new Set,this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onBlur=this._onBlur.bind(this),this._onVisibility=this._onVisibility.bind(this),this._onPageHide=this._onPageHide.bind(this),this._listeners=[]}connectedCallback(){this._enabled&&this._attach()}disconnectedCallback(){this._detach()}attributeChangedCallback(e){if("disabled"!==e)return;const t=!this.hasAttribute("disabled");t&&!this._enabled?(this._enabled=!0,this._attach()):!t&&this._enabled&&(this._enabled=!1,this._detach())}setConfig({humKey:e,shapes:t}={}){e&&(this._config.humKey=e),Array.isArray(t)&&(this._config.shapes=t)}simulatePressKey(e){this._handlePress(e)}simulateReleaseKey(e){this._handleRelease(e)}_addL(e,t,s,i){e.addEventListener(t,s,i),this._listeners.push({target:e,type:t,fn:s,opts:i})}_attach(){const e={capture:!1,passive:!1},t={capture:!1,passive:!0};this._addL(window,"keydown",this._onKeyDown,e),this._addL(window,"keyup",this._onKeyUp,e),this._addL(window,"blur",this._onBlur,t),this._addL(document,"visibilitychange",this._onVisibility,t),this._addL(window,"pagehide",this._onPageHide,t)}_detach(){for(const{target:e,type:t,fn:s,opts:i}of this._listeners)e.removeEventListener(t,s,i?.capture??!1);this._listeners.length=0,this._downKeys.size&&this._releaseAll()}_onKeyDown(e){const t=(e.composedPath?.()[0]||e.target).tagName||"";if(/^(INPUT|TEXTAREA|SELECT)$/.test(t))return;const s=e.key,i=s?.toUpperCase?.()||"",h=(t,s)=>{this._emit(t,s),e.preventDefault()},n={O:"hk-toggle-power",M:"hk-toggle-mute",C:"hk-toggle-controls",Q:"hk-toggle-sequencer",P:"hk-toggle-seq-play"};if(n[i])return h(n[i]);if("L"===s&&e.shiftKey)return h("hk-toggle-latch");if("l"===s&&!e.shiftKey)return h("hk-toggle-loop");if("S"===s&&e.shiftKey)return h("hk-toggle-signature");if("s"===s&&!e.shiftKey)return h("hk-audio-signature");if("R"===i&&e.shiftKey)return h("fr-play");if("R"===i&&!e.shiftKey)return h("fr-toggle");if("ArrowUp"===s||"ArrowDown"===s)return h("hk-shape-step",{direction:"ArrowDown"===s?1:-1});if(this._downKeys.has(s))return e.preventDefault();this._downKeys.add(s);const o=this._mapKey(s);o&&h("hk-press",o)}_onKeyUp(e){const t=e.key;if(!this._downKeys.has(t))return;this._downKeys.delete(t);const s=this._mapKey(t);s&&this._emit("hk-release",s)}_onBlur(){this._releaseAll()}_onVisibility(){"hidden"===document.visibilityState&&this._releaseAll()}_onPageHide(){this._releaseAll()}_releaseAll(){for(const e of this._downKeys){const t=this._mapKey(e);t&&this._emit("hk-release",t)}this._downKeys.clear()}_handlePress(e){if(!this._downKeys.has(e)){this._downKeys.add(e);const t=this._mapKey(e);t&&this._emit("hk-press",t)}}_handleRelease(e){if(this._downKeys.delete(e)){const t=this._mapKey(e);t&&this._emit("hk-release",t)}}_mapKey(e){if("0"===e)return{key:e,idx:-1,shapeKey:this._config.humKey};const t=(e?.charCodeAt?.(0)??0)-49;return t>=0&&t<this._config.shapes.length?{key:e,idx:t,shapeKey:this._config.shapes[t]}:null}_emit(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))}}customElements.define("osc-hotkeys",OscHotkeys);export{OscHotkeys};