<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Audio GNARLS — Multi‑Line Title Engine (All Effects)</title>
<style>
  :root{
    --pink:#ff0064;--cyan:#00ffff;--yellow:#ffff00;--orange:#ff5500;--green:#00ff00;--blue:#00aaff;
    --glow-strong:0 0 10px var(--pink);--blur-bg:rgba(255,255,255,.15)
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
    color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative
  }
  .container{z-index:1;text-align:center;padding:2rem;max-width:1200px}
  h1{font-size:clamp(2rem,6vw,4.5rem);font-weight:800;margin:0 0 1.25rem;letter-spacing:3px;text-transform:uppercase;
      background:linear-gradient(45deg,#ff0064,#00ffff,#ffff00);-webkit-background-clip:text;background-clip:text;color:transparent;
      text-shadow:0 0 10px rgba(255,0,100,.7);animation:hueShift 10s linear infinite}
  .subtitle{font-size:1.05rem;max-width:820px;margin-inline:auto;color:#e0e0ff;line-height:1.6;margin-bottom:2rem}
  .title-wrap{position:relative;width:100%;min-height:clamp(160px,35vw,320px);display:grid;place-items:center;perspective:1000px;margin:1.5rem 0}
  .audio-title{font-family:"Arial Black",sans-serif;font-size:clamp(2.25rem,10vw,6rem);font-weight:900;text-transform:uppercase;letter-spacing:4px;white-space:nowrap;
               color:var(--pink);text-shadow:0 0 10px var(--pink);transform-style:preserve-3d;display:flex;flex-direction:column;gap:.35em}
  .line{display:block;white-space:nowrap}
  .char{display:inline-block;transform-origin:center}
  .effect-name{position:absolute;inset:auto 0 14px; text-align:center;font-size:1rem;color:#a0a0ff;letter-spacing:2px;text-transform:uppercase;
               text-shadow:0 0 10px rgba(160,160,255,.7);animation:pulse 2s infinite}
  .controls{display:flex;flex-direction:column;gap:.8rem;justify-content:center;margin-top:1rem}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.6rem;align-items:stretch;margin-top:.6rem}
  button,input,select,label{font:inherit}
  button{background:var(--blur-bg);border:1px solid rgba(255,255,255,.3);color:#fff;font-weight:600;font-size:1rem;padding:.6rem 1rem;border-radius:30px;cursor:pointer;
         transition:transform .25s ease,box-shadow .25s ease,background .25s ease;backdrop-filter:blur(6px);position:relative;overflow:hidden}
  button:hover{background:rgba(255,255,255,.25);transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.3)}
  button::before{content:"";position:absolute;inset:0;left:-100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.22),transparent);transition:left .5s}
  button:hover::before{left:100%}
  .field{display:flex;align-items:center;gap:.35rem;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);padding:.4rem .6rem;border-radius:12px}
  .field input{width:8rem;background:transparent;border:none;outline:none;color:#fff}
  .stack{display:flex;flex-direction:column;gap:.35rem}
  .row{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:center;align-items:center}
  .muted{opacity:.8}
  .particles{position:absolute;inset:0;pointer-events:none}
  .particle{position:absolute;width:4px;height:4px;border-radius:50%;box-shadow:0 0 10px currentColor}
  .footer{margin-top:1.5rem;color:rgba(255,255,255,.65);font-size:.9rem}

  /* --- Core keyframes (used by effects) --- */
  @keyframes float{0%,100%{transform:translate(0) rotate(0)}25%{transform:translate(15px,15px) rotate(90deg)}50%{transform:translate(20px,-20px) rotate(180deg)}75%{transform:translate(-15px,15px) rotate(270deg)}}
  @keyframes hueShift{to{filter:hue-rotate(360deg)}}
  @keyframes pulse{0%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.05)}100%{opacity:.7;transform:scale(1)}}
  @keyframes glitchChar{0%{transform:translate(0)}20%{transform:translate(-5px,2px);filter:blur(.5px)}40%{transform:translate(5px,-2px)}60%{transform:translate(-2px,5px)}80%{transform:translate(2px,-5px);filter:blur(.3px)}100%{transform:translate(0)}}
  @keyframes glitch{0%{transform:translate(0)}20%{transform:translate(-3px,3px)}40%{transform:translate(-3px,-3px)}60%{transform:translate(3px,3px)}80%{transform:translate(3px,-3px)}100%{transform:translate(0)}}
  @keyframes rainbow{0%{color:#f00}16%{color:#f80}33%{color:#ff0}50%{color:#0f0}66%{color:#08f}83%{color:#80f}100%{color:#f00}}
  @keyframes neon{0%,100%{text-shadow:0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #ff00de,0 0 35px #ff00de,0 0 40px #ff00de}50%{text-shadow:0 0 2px #fff,0 0 5px #fff,0 0 7px #fff,0 0 10px #ff00de,0 0 17px #ff00de,0 0 20px #ff00de}}
  @keyframes hologram{0%,100%{text-shadow:0 0 5px #0ff,0 0 10px #0ff,0 0 15px #0ff,0 0 20px #0ff;color:#0ff}25%{text-shadow:0 0 5px #f0f,0 0 10px #f0f,0 0 15px #f0f,0 0 20px #f0f;color:#f0f}50%{text-shadow:0 0 5px #ff0,0 0 10px #ff0,0 0 15px #ff0,0 0 20px #ff0;color:#ff0}75%{text-shadow:0 0 5px #0f0,0 0 10px #0f0,0 0 15px #0f0,0 0 20px #0f0;color:#0f0}}
  @keyframes fire{0%,100%{text-shadow:0 0 5px #f00,0 0 10px #f50,0 0 15px #fa0,0 0 20px #fa0;color:#f50}25%{text-shadow:0 0 5px #f50,0 0 10px #fa0,0 0 15px #ff0,0 0 20px #ff0;color:#fa0}50%{text-shadow:0 0 5px #fa0,0 0 10px #ff0,0 0 15px #ff5,0 0 20px #ff5;color:#ff0}}
  @keyframes matrix{0%{text-shadow:0 0 5px #0f0,0 0 10px #0f0,0 0 15px #0f0,0 0 20px #0f0;color:#0f0}50%{text-shadow:0 0 2px #0a0,0 0 5px #0a0,0 0 7px #0a0,0 0 10px #0a0;color:#0a0}100%{text-shadow:0 0 5px #0f0,0 0 10px #0f0,0 0 15px #0f0,0 0 20px #0f0;color:#0f0}}
  @keyframes levitate{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-30px)}}
  @keyframes stretch{0%,100%{transform:scaleX(1)}50%{transform:scaleX(1.2)}}
  @keyframes swing{0%,100%{transform:rotate(0)}25%{transform:rotate(5deg)}75%{transform:rotate(-5deg)}}
  @keyframes twirl{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.2)}100%{transform:rotate(360deg) scale(1)}}
  @keyframes implode{0%{transform:scale(0);opacity:0}70%{transform:scale(1.1);opacity:1}100%{transform:scale(1);opacity:1}}
  @keyframes explode{0%{transform:scale(1);opacity:1}30%{transform:scale(1.5);opacity:.7}100%{transform:scale(0);opacity:0}}
  @keyframes morph{0%{font-family:"Arial Black",sans-serif;letter-spacing:4px}25%{font-family:"Courier New",monospace;letter-spacing:2px}50%{font-family:Impact,sans-serif;letter-spacing:6px}75%{font-family:Georgia,serif;letter-spacing:1px}100%{font-family:"Arial Black",sans-serif;letter-spacing:4px}}
  @keyframes dissolve{from{opacity:1}to{opacity:0}} 
  @keyframes appear{from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}
  @keyframes slideIn{from{transform:translateX(-100%);opacity:0}to{transform:translateX(0);opacity:1}}
  @keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
  @keyframes flipIn{from{transform:rotateY(90deg);opacity:0}to{transform:rotateY(0);opacity:1}} 
  @keyframes flipOut{from{opacity:1}to{transform:rotateY(-90deg);opacity:0}}
  @keyframes rollIn{from{opacity:0;transform:rotate(-360deg) scale(0)}to{opacity:1;transform:rotate(0) scale(1)}}
  @keyframes rollOut{from{opacity:1}to{opacity:0;transform:rotate(360deg) scale(0)}}
  @keyframes blurIn{from{filter:blur(10px);opacity:0}to{filter:blur(0);opacity:1}} 
  @keyframes blurOut{from{filter:blur(0);opacity:1}to{filter:blur(10px);opacity:0}}
  @keyframes flash{50%{opacity:.1}} 
  @keyframes wobble{0%,100%{transform:translateX(0)}15%{transform:translateX(-25px) rotate(-5deg)}30%{transform:translateX(20px) rotate(3deg)}45%{transform:translateX(-15px) rotate(-3deg)}60%{transform:translateX(10px) rotate(2deg)}75%{transform:translateX(-5px) rotate(-1deg)}}
  @keyframes tada{0%{transform:scale(1)}10%,20%{transform:scale(.9) rotate(-3deg)}30%,50%,70%,90%{transform:scale(1.1) rotate(3deg)}40%,60%,80%{transform:scale(1.1) rotate(-3deg)}100%{transform:scale(1) rotate(0)}}
  @keyframes jello{0%,100%{transform:scale(1,1)}30%{transform:scale(1.25,.75)}40%{transform:scale(.75,1.25)}50%{transform:scale(1.15,.85)}65%{transform:scale(.95,1.05)}75%{transform:scale(1.05,.95)}}
  @keyframes heartBeat{0%{transform:scale(1)}14%{transform:scale(1.3)}28%{transform:scale(1)}42%{transform:scale(1.3)}70%{transform:scale(1)}}
  @keyframes hinge{0%{transform-origin:top left}20%,60%{transform:rotate(80deg)}40%,80%{transform:rotate(60deg);opacity:1}100%{transform:translateY(700px);opacity:0}}
  @keyframes jackInTheBox{0%{opacity:0;transform:scale(.1) rotate(30deg);transform-origin:center bottom}50%{transform:rotate(-10deg)}70%{transform:rotate(3deg)}100%{opacity:1;transform:scale(1)}}
  @keyframes lightSpeedIn{0%{transform:translateX(100%) skewX(-30deg);opacity:0}60%{transform:skewX(20deg);opacity:1}80%{transform:skewX(-5deg);opacity:1}100%{transform:translateX(0);opacity:1}}
  @keyframes lightSpeedOut{from{opacity:1}to{transform:translateX(100%) skewX(30deg);opacity:0}}
  @keyframes rotateIn{from{transform:rotate(-200deg);opacity:0}to{transform:rotate(0);opacity:1}}
  @keyframes rotateOut{from{opacity:1}to{transform:rotate(200deg);opacity:0}}
  @keyframes rotateInDownLeft{from{transform-origin:left bottom;transform:rotate(45deg);opacity:0}to{transform-origin:left bottom;transform:rotate(0);opacity:1}}
  @keyframes rotateInDownRight{from{transform-origin:right bottom;transform:rotate(-45deg);opacity:0}to{transform-origin:right bottom;transform:rotate(0);opacity:1}}
  @keyframes rotateInUpLeft{from{transform-origin:left bottom;transform:rotate(45deg);opacity:0}to{transform-origin:left bottom;transform:rotate(0);opacity:1}}
  @keyframes rotateInUpRight{from{transform-origin:right bottom;transform:rotate(-90deg);opacity:0}to{transform-origin:right bottom;transform:rotate(0);opacity:1}}
  @keyframes rotateOutDownLeft{from{transform-origin:left bottom;opacity:1}to{transform-origin:left bottom;transform:rotate(45deg);opacity:0}}
  @keyframes rotateOutDownRight{from{transform-origin:right bottom;opacity:1}to{transform-origin:right bottom;transform:rotate(-45deg);opacity:0}}
  @keyframes rotateOutUpLeft{from{opacity:1}to{transform-origin:left bottom;transform:rotate(45deg);opacity:0}}
  @keyframes rotateOutUpRight{from{opacity:1}to{transform-origin:right bottom;transform:rotate(90deg);opacity:0}}
  @keyframes zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}
  @keyframes zoomOut{0%{opacity:1}50%{opacity:0;transform:scale3d(.3,.3,.3)}100%{opacity:0}}
  @keyframes bounceIn{0%,20%,40%,60%,80%,100%{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:scale3d(.3,.3,.3)}20%{transform:scale3d(1.1,1.1,1.1)}40%{transform:scale3d(.9,.9,.9)}60%{opacity:1;transform:scale3d(1.03,1.03,1.03)}80%{transform:scale3d(.97,.97,.97)}100%{opacity:1;transform:scale3d(1,1,1)}}
  @keyframes bounceOut{20%{transform:scale3d(.9,.9,.9)}50%,55%{opacity:1;transform:scale3d(1.1,1.1,1.1)}100%{opacity:0;transform:scale3d(.3,.3,.3)}}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}} 
  @keyframes fadeOut{from{opacity:1}to{opacity:0}}
  @keyframes fadeInDown{from{opacity:0;transform:translate3d(0,-100%,0)}to{opacity:1;transform:translate3d(0,0,0)}}
  @keyframes fadeOutDown{from{opacity:1}to{opacity:0;transform:translate3d(0,100%,0)}}
  @keyframes fadeInUp{from{opacity:0;transform:translate3d(0,100%,0)}to{opacity:1;transform:translate3d(0,0,0)}}
  @keyframes fadeOutUp{from{opacity:1}to{opacity:0;transform:translate3d(0,-100%,0)}}
  @keyframes fadeInLeft{from{opacity:0;transform:translate3d(-100%,0,0)}to{opacity:1;transform:translate3d(0,0,0)}}
  @keyframes fadeOutLeft{from{opacity:1}to{opacity:0;transform:translate3d(-100%,0,0)}}
  @keyframes fadeInRight{from{opacity:0;transform:translate3d(100%,0,0)}to{opacity:1;transform:translate3d(0,0,0)}}
  @keyframes fadeOutRight{from{opacity:1}to{opacity:0;transform:translate3d(100%,0,0)}}
  @keyframes slideInDown{from{transform:translate3d(0,-100%,0);visibility:visible}to{transform:translate3d(0,0,0)}}
  @keyframes slideInLeft{from{transform:translate3d(-100%,0,0);visibility:visible}to{transform:translate3d(0,0,0)}}
  @keyframes slideInRight{from{transform:translate3d(100%,0,0);visibility:visible}to{transform:translate3d(0,0,0)}}
  @keyframes slideInUp{from{transform:translate3d(0,100%,0);visibility:visible}to{transform:translate3d(0,0,0)}}
  @keyframes slideOutDown{from{transform:translate3d(0,0,0)}to{visibility:hidden;transform:translate3d(0,100%,0)}}
  @keyframes slideOutLeft{from{transform:translate3d(0,0,0)}to{visibility:hidden;transform:translate3d(-100%,0,0)}}
  @keyframes slideOutRight{from{transform:translate3d(0,0,0)}to{visibility:hidden;transform:translate3d(100%,0,0)}}
  @keyframes slideOutUp{from{transform:translate3d(0,0,0)}to{visibility:hidden;transform:translate3d(0,-100%,0)}}
  @keyframes zoomInDown{0%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(0,-1000px,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(0,60px,0);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
  @keyframes zoomInLeft{0%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(-1000px,0,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(10px,0,0);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
  @keyframes zoomInRight{0%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(1000px,0,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(-10px,0,0);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
  @keyframes zoomInUp{0%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(0,1000px,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
  @keyframes zoomOutDown{40%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}100%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(0,2000px,0);transform-origin:center bottom;animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
  @keyframes zoomOutLeft{40%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(42px,0,0)}100%{opacity:0;transform:scale(.1) translate3d(-2000px,0,0);transform-origin:left center}}
  @keyframes zoomOutRight{40%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(-42px,0,0)}100%{opacity:0;transform:scale(.1) translate3d(2000px,0,0);transform-origin:right center}}
  @keyframes zoomOutUp{40%{opacity:1;transform:scale3d(.475,.475,.475) translate3d(0,60px,0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}100%{opacity:0;transform:scale3d(.1,.1,.1) translate3d(0,-2000px,0);transform-origin:center bottom;animation-timing-function:cubic-bezier(.175,.885,.32,1)}}
</style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="container">
    <h1>Audio GNARLS — Multi‑Line Title Engine (All Effects)</h1>
    <p class="subtitle">Render as a single line or multiple lines. Apply different effects per line. Includes the complete original effect set + presets (Single, Double, Word Strobe).</p>

    <div class="title-wrap">
      <div class="audio-title" id="title"></div>
      <div class="effect-name" id="effect-name">Ready</div>
    </div>

    <div class="controls">
      <div class="grid">
        <div class="stack">
          <label class="field"><span>Line 1</span><input id="line1" placeholder="Audio" value="Audio" /></label>
          <label class="field"><span>In Effect</span><select id="fx1-in"></select></label>
          <label class="field"><span>Out Effect</span><select id="fx1-out"></select></label>
        </div>
        <div class="stack">
          <label class="field"><span>Line 2</span><input id="line2" placeholder="GNARLS" value="GNARLS" /></label>
          <label class="field"><span>In Effect</span><select id="fx2-in"></select></label>
          <label class="field"><span>Out Effect</span><select id="fx2-out"></select></label>
        </div>
        <div class="stack">
          <label class="field" title="Milliseconds between sequence frames">
            <span>In/Out Delay</span>
            <input id="seq-interval" type="number" min="100" step="50" value="1200" />
            <span>ms</span>
          </label>
          <label class="field" title="How many times the sequence repeats before stopping">
            <span>Repeats</span>
            <input id="seq-repeats" type="number" min="1" step="1" value="4" />
          </label>
        </div>
      </div>

      <div class="row">
        <button id="render-once">Render Once</button>
        <button id="play-seq">Play Sequence</button>
        <button id="stop-seq">Stop Sequence</button>
        <button id="randomize">Randomize All</button>
        <button id="font-btn">Random Font</button>
      </div>

      <div class="row">
        <span class="muted">Presets:</span>
        <button data-preset="single" class="preset">Single Line</button>
        <button data-preset="double" class="preset">Two Lines</button>
        <button data-preset="wordpulse" class="preset">Word Strobe</button>
      </div>
    </div>

    <div class="footer">Audio GNARLS | Flexible Multi‑Line Visual Title System — In + Out Effects</div>
  </div>

<script>
(() => {
  /* ------------------------ Particles ------------------------ */
  const particlesEl = document.getElementById('particles');
  (function makeParticles(){
    const frag = document.createDocumentFragment();
    for (let i=0;i<90;i++){
      const p = document.createElement('div');
      const size = Math.random()*6+2;
      p.className='particle';
      p.style.width=p.style.height=`${size}px`;
      p.style.left=`${Math.random()*100}%`;
      p.style.top=`${Math.random()*100}%`;
      p.style.opacity = (Math.random()*0.8+0.2).toFixed(2);
      p.style.animation = `float ${12+Math.random()*10}s ease-in-out ${Math.random()*5}s infinite`;
      p.style.color = `hsl(${(Math.random()*360)|0} 100% 70%)`;
      frag.appendChild(p);
    }
    particlesEl.appendChild(frag);
  })();

  /* ------------------------ Renderer ------------------------ */
  const titleEl = document.getElementById('title');
  const effectNameEl = document.getElementById('effect-name');

  const fonts = [
    "'Arial Black', sans-serif",
    "'Courier New', monospace",
    "'Impact', sans-serif",
    "'Georgia', serif",
    "'Trebuchet MS', sans-serif",
    "'Lucida Console', monospace",
    "'Palatino Linotype', serif",
    "'Verdana', sans-serif"
  ];
  let fontIdx = 0;

  const colors = ['#ff0064', '#00ffff', '#ffff00', '#ff5500', '#00ff00', '#00aaff', '#ff00de', '#f0f', '#0ff'];
  const shadows = [
    '0 0 10px var(--pink)',
    '0 0 10px var(--cyan)',
    '0 0 15px #ff5500',
    '0 0 10px #f0f, 0 0 20px #f0f',
    '0 0 5px #fff, 0 0 15px #ff00de',
    '0 0 10px #0f0',
    '0 0 20px #0ff'
  ];

  const durations = ['1s', '1.2s', '1.5s', '2s'];
  const easings = ['ease', 'ease-in-out', 'cubic-bezier(0.68,-0.55,0.265,1.55)', 'linear'];

  const Renderer = {
    setLines(lines){
      titleEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      lines.forEach((lineText) => {
        const line = document.createElement('div');
        line.className = 'line';
        if (!lineText) { frag.appendChild(line); return; }
        for (const ch of lineText) {
          const span = document.createElement('span');
          span.className = 'char';
          span.innerHTML = ch === ' ' ? '&nbsp;' : ch;
          line.appendChild(span);
        }
        frag.appendChild(line);
      });
      titleEl.appendChild(frag);
      return this.getLines();
    },
    getLines(){ return Array.from(titleEl.querySelectorAll('.line')); },
    getCharsOf(lineIdx){
      const line = this.getLines()[lineIdx];
      return line ? Array.from(line.querySelectorAll('.char')) : [];
    },
    setStyle(color, shadow){ 
      titleEl.style.color = color; 
      titleEl.style.textShadow = shadow; 
    },
    applyKeyframeToChars(lineIdx, key, options = {}){
      const { duration='1s', iter='forwards', easing='', perCharDelay=.05, applyOnTitle=false } = options;
      if (applyOnTitle) {
        titleEl.style.animation = `${key} ${duration} ${easing} ${iter}`.trim();
      } else {
        const chars = this.getCharsOf(lineIdx);
        chars.forEach((ch,i)=>{
          ch.style.animation = `${key} ${duration} ${easing} ${iter} ${i*perCharDelay}s`.replace(/\s+/g,' ').trim();
        });
      }
    },
    clearAnimations(){
      titleEl.querySelectorAll('.char,.line').forEach(el=>{
        el.style.animation = 'none';
        el.style.transition = 'none';
        el.style.transform = '';
        el.style.opacity = '';
        el.style.filter = '';
      });
    }
  };

  /* ------------------------ Effects Registry ------------------------ */
  const Effects = new Map();
  const define = (name, fn) => { Effects.set(name, fn); };

  // Reuse your existing effects
  const cssFX = [
    ['Rainbow Text','rainbow','var(--pink)','0 0 10px var(--pink)',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Neon Glow','neon','#ff00de','0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #ff00de,0 0 35px #ff00de,0 0 40px #ff00de',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Hologram','hologram','#0ff','0 0 5px #0ff',{duration:'3s',iter:'infinite',perCharDelay:.1}],
    ['Fire Text','fire','#ff5500','0 0 5px #f00,0 0 10px #f50,0 0 15px #fa0,0 0 20px #fa0',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Matrix Code','matrix','#0f0','0 0 5px #0f0',{duration:'1.5s',iter:'infinite',perCharDelay:.1}],
    ['Digital Glitch','glitch','#f0f','0 0 10px #f0f',{duration:'.5s',iter:'infinite',perCharDelay:.05}],
    ['Levitate','levitate','var(--yellow)','0 0 10px var(--yellow)',{duration:'3s',iter:'infinite',easing:'ease-in-out',perCharDelay:.1}],
    ['Spin Text','spin','var(--cyan)','0 0 10px var(--cyan)',{duration:'5s',iter:'infinite',easing:'linear',perCharDelay:.1}],
    ['Bounce Text','bounce','var(--pink)','0 0 10px var(--pink)',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Stretch Text','stretch','var(--green)','0 0 10px var(--green)',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Swing Text','swing','#ff5500','0 0 10px #ff5500',{duration:'2s',iter:'infinite',perCharDelay:.1}],
    ['Twirl Text','twirl','var(--blue)','0 0 10px var(--blue)',{duration:'3s',iter:'infinite',perCharDelay:.1}],
    ['Implode','implode','#f0f','0 0 10px #f0f',{duration:'1s'}],
    ['Explode','explode','var(--yellow)','0 0 10px var(--yellow)',{duration:'1s'}],
    ['Morph Text','morph','var(--cyan)','0 0 10px var(--cyan)',{duration:'4s',iter:'infinite',perCharDelay:.1}],
    ['Dissolve','dissolve','var(--pink)','0 0 10px var(--pink)',{duration:'2s'}],
    ['Appear','appear','var(--green)','0 0 10px var(--green)',{duration:'1s'}],
    ['Slide In','slideIn','#ff5500','0 0 10px #ff5500'],
    ['Slide Out','slideOut','var(--blue)','0 0 10px var(--blue)'],
    ['Flip In','flipIn','#f0f','0 0 10px #f0f'],
    ['Flip Out','flipOut','var(--yellow)','0 0 10px var(--yellow)'],
    ['Roll In','rollIn','var(--cyan)','0 0 10px var(--cyan)'],
    ['Roll Out','rollOut','var(--pink)','0 0 10px var(--pink)'],
    ['Blur In','blurIn','var(--green)','0 0 10px var(--green)'],
    ['Blur Out','blurOut','#ff5500','0 0 10px #ff5500'],
    ['Flash','flash','var(--blue)','0 0 10px var(--blue)',{duration:'1s',iter:'infinite'}],
    ['Wobble','wobble','#f0f','0 0 10px #f0f',{duration:'1s',iter:'infinite'}],
    ['Tada','tada','var(--yellow)','0 0 10px var(--yellow)',{duration:'1s',iter:'infinite'}],
    ['Jello','jello','var(--cyan)','0 0 10px var(--cyan)',{duration:'1s',iter:'infinite'}],
    ['Heart Beat','heartBeat','var(--pink)','0 0 10px var(--pink)',{duration:'1.5s',iter:'infinite'}],
    ['Hinge','hinge','var(--green)','0 0 10px var(--green)',{duration:'2s',applyOnTitle:true}],
    ['Jack In The Box','jackInTheBox','#ff5500','0 0 10px #ff5500'],
    ['Light Speed In','lightSpeedIn','var(--blue)','0 0 10px var(--blue)'],
    ['Light Speed Out','lightSpeedOut','#f0f','0 0 10px #f0f'],
    ['Rotate In','rotateIn','var(--yellow)','0 0 10px var(--yellow)'],
    ['Rotate Out','rotateOut','var(--cyan)','0 0 10px var(--cyan)'],
    ['Zoom In','zoomIn','var(--pink)','0 0 10px var(--pink)'],
    ['Zoom Out','zoomOut','var(--green)','0 0 10px var(--green)'],
    ['Bounce In','bounceIn','#ff5500','0 0 10px #ff5500'],
    ['Fade In','fadeIn','#f0f','0 0 10px #f0f'],
    ['Fade Out','fadeOut','var(--yellow)','0 0 10px var(--yellow)']
  ];

  cssFX.forEach(([name,key,color,shadow,opt])=>{
    define(name,(R,i)=>{ 
      R.setStyle(color,shadow); 
      R.applyKeyframeToChars(i,key,Object.assign({perCharDelay:.05},opt||{})); 
    });
  });

  const EFFECT_LIST = Array.from(Effects.keys());

  /* ------------------------ In+Out Effect Orchestrator ------------------------ */
  function applyInOutEffect(renderer, lineIdx, inEffect, outEffect, delay = 1200) {
    const inFx = Effects.get(inEffect);
    const outFx = Effects.get(outEffect);

    if (!inFx) return;

    // Randomize style
    const color = colors[Math.floor(Math.random() * colors.length)];
    const shadow = shadows[Math.floor(Math.random() * shadows.length)];
    const duration = durations[Math.floor(Math.random() * durations.length)];
    const easing = easings[Math.floor(Math.random() * easings.length)];

    renderer.setStyle(color, shadow);
    inFx(renderer, lineIdx);

    setTimeout(() => {
      renderer.setStyle(color, shadow);
      if (outFx) outFx(renderer, lineIdx);
      setTimeout(() => renderer.clearAnimations(), 1000);
    }, delay);
  }

  /* ------------------------ Sequencer ------------------------ */
  class Sequencer {
    constructor() { this.timer = null; this.running = false; this.idx = 0; this.frames = []; this.repeats = 1; this.loops = 0; this.interval = 600; }
    load(frames, { interval = 600, repeats = 1 } = {}) {
      this.frames = frames;
      this.interval = interval;
      this.repeats = repeats;
      this.idx = 0;
      this.loops = 0;
    }
    stop() {
      this.running = false;
      clearTimeout(this.timer);
      this.timer = null;
      effectNameEl.textContent = 'Stopped';
    }
    play() {
      if (!this.frames.length) return;
      this.running = true;
      const step = () => {
        if (!this.running) return;
        const f = this.frames[this.idx];
        renderWithInOut(f.lines, f.inEffects, f.outEffects);
        effectNameEl.textContent = `${f.inEffects.join(' → ')}  →  ${f.outEffects.join(' → ')}`;
        this.idx++;
        if (this.idx >= this.frames.length) {
          this.idx = 0;
          this.loops++;
          if (this.loops >= this.repeats) { this.stop(); return; }
        }
        this.timer = setTimeout(step, this.interval);
      };
      step();
    }
  }
  const SEQ = new Sequencer();

  /* ------------------------ Helpers ------------------------ */
  function renderWithInOut(lines, inEffects, outEffects) {
    Renderer.clearAnimations();
    const lineNodes = Renderer.setLines(lines);
    lineNodes.forEach((_, i) => {
      const inEffect = inEffects[i] || rand(EFFECT_LIST);
      const outEffect = outEffects[i] || rand(EFFECT_LIST);
      applyInOutEffect(Renderer, i, inEffect, outEffect, Number(document.getElementById('seq-interval').value));
    });
  }

  function rand(arr) { return arr[(Math.random() * arr.length) | 0]; }

  function renderOnce() {
    const lines = [line1.value, line2.value];
    const inEffects = [fx1In.value, fx2In.value];
    const outEffects = [fx1Out.value, fx2Out.value];
    renderWithInOut(lines, inEffects, outEffects);
    effectNameEl.textContent = `${inEffects.join(' → ')} → ${outEffects.join(' → ')}`;
  }

  // Randomize UI
  document.getElementById('randomize').addEventListener('click', () => {
    fx1In.value = rand(EFFECT_LIST);
    fx1Out.value = rand(EFFECT_LIST);
    fx2In.value = rand(EFFECT_LIST);
    fx2Out.value = rand(EFFECT_LIST);
    fontIdx = Math.floor(Math.random() * fonts.length);
    titleEl.style.fontFamily = fonts[fontIdx];
    renderOnce();
  });

  document.getElementById('font-btn').addEventListener('click', () => {
    fontIdx = (fontIdx + 1) % fonts.length;
    titleEl.style.fontFamily = fonts[fontIdx];
  });

  // Populate dropdowns
  const fx1In = document.getElementById('fx1-in');
  const fx1Out = document.getElementById('fx1-out');
  const fx2In = document.getElementById('fx2-in');
  const fx2Out = document.getElementById('fx2-out');
  EFFECT_LIST.forEach(name => {
    [fx1In, fx1Out, fx2In, fx2Out].forEach(sel => sel.add(new Option(name, name)));
  });
  fx1In.value = 'Zoom In';
  fx1Out.value = 'Zoom Out';
  fx2In.value = 'Rainbow Text';
  fx2Out.value = 'Fade Out';

  // Presets
  function presetSingle() {
    const text = (line1.value + ' ' + line2.value).trim();
    return [{ lines: [text], inEffects: [fx1In.value], outEffects: [fx1Out.value] }];
  }

  function presetDouble() {
    return [{
      lines: [line1.value, line2.value],
      inEffects: [fx1In.value, fx2In.value],
      outEffects: [fx1Out.value, fx2Out.value]
    }];
  }

  function presetWordPulse() {
    const a = line1.value || '';
    const b = line2.value || '';
    return [
      { lines: [a], inEffects: [fx1In.value], outEffects: [fx1Out.value] },
      { lines: [''], inEffects: ['Appear'], outEffects: ['Fade Out'] },
      { lines: [b], inEffects: [fx2In.value], outEffects: [fx2Out.value] },
      { lines: [''], inEffects: ['Appear'], outEffects: ['Fade Out'] }
    ];
  }

  function playPreset(kind) {
    const interval = Math.max(100, Number(document.getElementById('seq-interval').value));
    const repeats = Math.max(1, Math.floor(Number(document.getElementById('seq-repeats').value)));
    let frames = [];
    if (kind === 'single') frames = presetSingle();
    else if (kind === 'double') frames = presetDouble();
    else if (kind === 'wordpulse') frames = presetWordPulse();
    else frames = presetDouble();
    SEQ.stop();
    SEQ.load(frames, { interval, repeats });
    SEQ.play();
  }

  document.getElementById('render-once').addEventListener('click', renderOnce);
  document.getElementById('play-seq').addEventListener('click', () => {
    const lastPresetBtn = document.querySelector('.preset.active');
    const kind = lastPresetBtn ? lastPresetBtn.dataset.preset : 'double';
    playPreset(kind);
  });
  document.getElementById('stop-seq').addEventListener('click', () => SEQ.stop());

  document.querySelectorAll('.preset').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.preset').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const k = btn.dataset.preset;
      if (k === 'single') renderWithInOut([(line1.value + ' ' + line2.value).trim()], [fx1In.value], [fx1Out.value]);
      if (k === 'double') renderWithInOut([line1.value, line2.value], [fx1In.value, fx2In.value], [fx1Out.value, fx2Out.value]);
      if (k === 'wordpulse') renderWithInOut([line1.value], [fx1In.value], [fx1Out.value]);
      effectNameEl.textContent = `Preset: ${btn.textContent}`;
    });
  });

  // Initial render
  renderOnce();
  document.querySelector('[data-preset="double"]').classList.add('active');
})();
</script>
</body>
</html>