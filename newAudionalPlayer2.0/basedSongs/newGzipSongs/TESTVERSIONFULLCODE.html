<!DOCTYPE html>
<title>TRUTH</title>
<link rel="stylesheet" href="/content/27679fb51975e991284bebdaa2e340ab0f4002ea5423c8849106e4dabbd43627i0">

<script>
const handleError = (error, context) => {
    console.error(`Error in ${context}:`, error);
};

// Function to fetch text data
const fetchText = async (url, context) => {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Failed to fetch ${context}`);
        return await response.text();
    } catch (error) {
        handleError(error, context);
        return null;
    }
};

// Function to fetch array buffer data
const fetchArrayBuffer = async (url, context) => {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Failed to fetch ${context}`);
        return await response.arrayBuffer();
    } catch (error) {
        handleError(error, context);
        return null;
    }
};

const keyMap = {0: "projectName", 1: "artistName", 2: "projectBPM", 3: "currentSequence", 4: "channelURLs", 5: "channelVolume", 6: "channelPlaybackSpeed", 7: "trimSettings", 8: "projectChannelNames", 9: "startSliderValue", 10: "endSliderValue", 11: "totalSampleDuration", 12: "start", 13: "end", 14: "projectSequences", 15: "steps"};
const reverseKeyMap = {};
const channelMap = [];
const reverseChannelMap = {};

for (let e = 0; e < 26; e++) {
    const a = String.fromCharCode(65 + e);
    channelMap.push(a);
    reverseChannelMap[a] = e;
}

Object.entries(keyMap).forEach(([e, a]) => {
    reverseKeyMap[a] = +e;
});

const decompressSteps = e => e.reduce((e, a) => {
    if (typeof a === 'number') {
        e.push(a);
    } else if (typeof a === 'object' && 'r' in a) {
        const [t, n] = a.r;
        for (let a = t; a <= n; a++) e.push(a);
    } else if (typeof a === 'string' && a.endsWith('r')) {
        e.push({index: parseInt(a.slice(0, -1), 10), reverse: true});
    }
    return e;
}, []);

const recursiveDeserialize = e => Array.isArray(e) ? e.map(e => typeof e === 'object' ? recursiveDeserialize(e) : e) : e && typeof e === 'object' ? Object.entries(e).reduce((e, [a, t]) => {
    const n = keyMap[a] ?? a;
    return e[n] = n === 'projectSequences' ? Object.entries(t).reduce((e, [a, t]) => {
        return e[`s${a.replace("Sequence", "")}`] = Object.fromEntries(Object.entries(t).map(([e, a]) => {
            return [`ch${reverseChannelMap[e]}`, {steps: (t = a[reverseKeyMap.steps] || [], t.reduce((e, a) => {
                if (typeof a === 'number') e.push(a); else if (typeof a === 'object' && 'r' in a) {
                    const [t, n] = a.r;
                    for (let a = t; a <= n; a++) e.push(a);
                } else if (typeof a === 'string' && a.endsWith('r')) e.push({index: parseInt(a.slice(0, -1), 10), reverse: true});
                return e;
            }, []))}];
        })), e;
    }, {}) : recursiveDeserialize(t), e;
}, {}) : e;

const loadPako = async () => {
    try {
        const htmlContent = await fetchText("/content/2109694f44c973892fb8152cf5c68607fb19288c045af1abc1716c1c3b4d69e6i0", "Pako Loader");
        if (!htmlContent) throw new Error("Failed to load HTML content.");

        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlContent;
        const pakoScript = tempDiv.querySelector('script');

        if (!pakoScript) throw new Error("Pako library not found in the HTML content.");

        const scriptElement = document.createElement('script');
        scriptElement.textContent = pakoScript.textContent;
        document.head.appendChild(scriptElement);

        console.log("Pako library loaded:", pako);
    } catch (error) {
        handleError(error, "Load Pako");
    }
};

const processSerializedData = async url => {
    try {
        await loadPako();
        const compressedData = await fetchArrayBuffer(url, "Serialized Data");
        if (!compressedData) throw new Error("Failed to fetch compressed data.");

        const decompressedData = pako.inflate(new Uint8Array(compressedData));
        const jsonString = new TextDecoder('utf-8').decode(decompressedData);
        const serializedData = JSON.parse(jsonString);
        const originalData = recursiveDeserialize(serializedData);
        console.log("Deserialized Data:", originalData);
        window.jsonData = originalData;
    } catch (error) {
        handleError(error, "Process Serialized Data");
    }
};

function loadScript(url, callback) {
    const script = document.createElement("script");
    script.src = url;
    script.onload = callback;
    script.onerror = () => console.error(`[debug] Error loading script: ${url}`);
    document.head.appendChild(script);
}

loadScript("/content/e575d3519ca3d6eb6a8d34e4c969dee9ef72b84766fd3f8f2ed2aeead06a4f66i0", function() {
    console.log("[debug] titleConfig.js loaded successfully.");
    function initializeAudioContextManager() {
        if (!window.AudioContextManager) {
            class AudioContextManager {
                constructor() {
                    if (!AudioContextManager.instance) {
                        this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        AudioContextManager.instance = this;
                    }
                    return AudioContextManager.instance;
                }

                getAudioContext() {
                    return this.audioCtx;
                }

                async resume() {
                    console.log(`[resume] [finalDebug] AudioContext State: ${this.audioCtx.state}`);
                    if (this.audioCtx.state === "suspended") {
                        await this.audioCtx.resume();
                        console.log("AudioContext resumed");
                    }
                }
            }
            window.AudioContextManager = new AudioContextManager();
        }
    }

    initializeAudioContextManager();

    new Map();
    new Map();
    window.AudioContextManager.getAudioContext();
    new BroadcastChannel("channel_playback");

    window.audionalPlayerScripts = [
        "/content/204885c72322cbaa0272bae20c992db17e4c88da9938bbff9ba1fa7dd325fa4bi0", // THIS SCRIPT NEEDS TO BE |EMBEDDED IN FULL
        "/content/150e020d5e6ea8b53b7b3d2160f25f65c2e550d413f9c53d9e1cfb101d6914f2i0",
        "/content/935828577e4762caaf32b76a0f74cb4f37bdcdbdae1d27a7c93d000d5cfe9d28i0",
        "/content/bab2b37e0abcce41d784d65d94a5c3c266228c2d8bd3ecdee4fba7986f5a042ei0",
        "/content/1a5cafb61e4a320434fc4087e203d2a5f695ba9112635b960fc9d7dcb961d9fci0",
        "/content/a3d8a40fcde6935f16b49ad7c9e9aa185f01d1618f4e35828415f6cc27377a47i0",
        "/content/17c6cb4f92d47043da52ce8334c41961c588b7955488e56f08264840ef63a4eei0"
    ];

    const loaderScripts = [
        "/content/5e2a8243e075f7a23e94f9bd4de5154c260f4157317bce504372523cf8d24c8ai0",
        "/content/7e14b0798d8244ba8b94a9e474a05000ccc335aa51aa69b06b53bea73224fa71i0",
        "/content/9a90ce273218fdf878e9c36e35f4ac4ebf47f9fb93ba00eabfe8a51958b90b4ei0",
        "/content/c0a912d642dba6d9e02ac59744c516b88d052630301f410535e6167809cd8ceai0",
        "/content/fd3da6a5f15f8a379e7219302997ae07d152d69ba413a0e36cb9bb85cbb1f14fi0"
    ];

    function loadAllScripts() {
        function loadScriptsSequentially(scripts, callback) {
            const loadNext = index => {
                if (index >= scripts.length) {
                    callback();
                } else {
                    loadScript(scripts[index], () => loadNext(index + 1));
                }
            };
            loadNext(0);
        }

        loadScriptsSequentially(loaderScripts, () => {
            window.scriptsToLoad = [
                ...window.audionalPlayerScripts,
                ...window.titleDisplayScripts,
                ...window.colourPaletteScrips,
                ...window.colourSettingsScripts,
                ...window.visualiserScripts,
                ...window.visualiserLoggingScripts
            ];
            loadScript("/content/f9b3a2f4a426432ead5c01e2e80c18cc7eb14f567cbea8254f66f7fa5a7d0061i0", () => {
                console.log("[debug] loader_NoBlobs.js loaded successfully.");
            });
        });
    }

    loadAllScripts();
});

window.seed = 199;
const dataUrl = "/content/5527d0cc95ce5ce6eedf4e275234da8b1fe087512d0db618b6de1aaad437c96bi0";
processSerializedData(dataUrl);
</script>
