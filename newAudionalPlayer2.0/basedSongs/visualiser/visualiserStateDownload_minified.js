// visualiserStateDownload.js

const downloadCurrentVisualStateWithText=()=>{const e=document.querySelector("canvas");if(!e)return console.error("No canvas element found.");const{accessLevel:t,assignments:n,timecode:o}={accessLevel:AccessLevel,assignments:getAssignments(renderingState),timecode:getTimecode()},s=[`Access Level: ${t}`,"Assignments:",...n.map(((e,t)=>`Channel ${t+1}: ${e}`)),`Timecode: ${o} ms`],a=document.createElement("canvas");a.width=e.width,a.height=e.height;const c=a.getContext("2d");c.drawImage(e,0,0),c.font="12px Arial",c.fillStyle="#1b1b1b",c.shadowColor="black",c.shadowBlur=4,c.textAlign="right";const i=a.height-10-14.4*(s.length-1);s.forEach(((e,t)=>c.fillText(e,a.width-10,i+14.4*t))),a.toBlob((e=>{const t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`visual_state_${(new Date).toISOString()}.jpeg`,t.click()}),"image/jpeg")};document.addEventListener("keydown",(e=>{"KeyP"===e.code&&downloadCurrentVisualStateWithText()}));