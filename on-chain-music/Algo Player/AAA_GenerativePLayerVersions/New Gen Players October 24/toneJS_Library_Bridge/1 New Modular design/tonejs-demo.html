<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ToneJS Demo by Audionals (v14.7.40)</title>
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body Styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header Styling */
        #header {
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
            text-align: center;
            font-size: 28px;
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Thanks Text Styling */
        #thanks {
            padding: 10px 20px;
            background-color: #333333;
            color: #dddddd;
            text-align: center;
            font-size: 16px;
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Demo Button Styling */
        #playChordButton {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        #playChordButton:hover:not(:disabled) {
            background-color: #0056b3;
        }

        #playChordButton:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* Drop-Down Menu Styling */
        details {
            width: 100%;
            max-width: 800px;
            background-color: #1a1a1a;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        summary {
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            color: #ffffff;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary:before {
            content: "â–¶ ";
            display: inline-block;
            margin-right: 10px;
            transition: transform 0.2s;
        }

        details[open] summary:before {
            transform: rotate(90deg);
        }

        pre {
            background-color: #2c2c2c;
            padding: 10px;
            overflow-x: auto;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #f8f8f2;
        }

        code {
            background-color: #2c2c2c;
            padding: 2px 4px;
            border-radius: 4px;
            color: #f8f8f2;
        }

        /* Demo App Container Styling */
        #demoAppContainer {
            padding: 20px;
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #1a1a1a;
            border: 1px solid #444444;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        #demoAppHeader {
            font-size: 20px;
            margin-bottom: 15px;
            color: #ffffff;
        }

        #demoStatus {
            margin-top: 15px;
            font-size: 14px;
            color: #cccccc;
        }

        /* Responsive Adjustments */
        @media (max-width: 600px) {
            #header, #thanks, details, #demoAppContainer {
                padding: 15px;
            }

            summary {
                font-size: 16px;
            }

            #demoAppHeader {
                font-size: 18px;
            }

            #playChordButton {
                width: 100%;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Display -->
    <div id="header">
        <strong>Audionals and Ordinal Based 1's Present Tone.js</strong>
    </div>

    <!-- Thanks Text -->
    <div id="thanks">
        Immutable gratitude to The Ordinal Based 1 Team for inscribing the Tone.js library on the blockchain.<br><br>
        Also to Audionals and jim.btc for building this bridge to make it more accessible for everyone.
    </div>

    <!-- Drop-Down Menu: Example Implementation -->
    <details>
        <summary>View Example Implementation: How to use this script in your own Web3 music apps</summary>
        <pre>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;My Web3 App with ToneJS&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;button id="playButton"&gt;Play a Note&lt;/button&gt;
    &lt;div id="status"&gt;Status: Loading ToneJS...&lt;/div&gt;

    &lt;!-- Include the ToneJS Bridge Script --&gt;
    &lt;script src="path/to/tonejs-bridge.js"&gt;&lt;/script&gt;
    &lt;!-- Replace "path/to/" with the actual URL where the bridge script is hosted --&gt;

    &lt;script&gt;
        // Wait for Tone.js to load
        (function waitForTone() {
            if (typeof Tone !== 'undefined') {
                // Tone.js is ready to use
                const synth = new Tone.Synth().toDestination();
                document.getElementById('playButton').addEventListener('click', () => {
                    synth.triggerAttackRelease('C4', '8n');
                });
                document.getElementById('status').textContent = 'Status: Tone.js is ready.';
            } else {
                // Check again after a short delay
                setTimeout(waitForTone, 50);
            }
        })();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
        </pre>
    </details>

    <!-- Demo App Container -->
    <div id="demoAppContainer">
        <div id="demoAppHeader">Test the Web3 Tone.js Library Using the Button Below.</div>
        <div id="demoStatus">Status: Loading Tone.js...</div>
    </div>

    <!-- Demo Button -->
    <button id="playChordButton" disabled>
        <strong>Click to Start Generative Chord Progression Using Tone.js</strong>
    </button>

    <!-- Include the ToneJS Bridge Script -->
    <script src="tonejs-bridge.js"></script>

    <!-- Initialization Script -->
    <script>
        // Wait for Tone.js to load
        (function waitForTone() {
            if (typeof Tone !== 'undefined') {
                // Tone.js is ready to use
                document.getElementById('demoStatus').textContent = 'Status: Ready to play.';
                initializeDemoApp();
            } else {
                // Check again after a short delay
                setTimeout(waitForTone, 50);
            }
        })();

        /**
         * Function to initialize the Demo App's functionalities.
         */
        function initializeDemoApp() {
            const playChordButton = document.getElementById('playChordButton');
            const demoStatus = document.getElementById('demoStatus');

            // Define chords with their notes and names
            const chords = [
                { name: "C Major", notes: ["C4", "E4", "G4"] },
                { name: "F Major", notes: ["F4", "A4", "C5"] },
                { name: "G Major", notes: ["G4", "B4", "D5"] },
                { name: "A Minor", notes: ["A4", "C5", "E5"] },
                { name: "D Minor", notes: ["D4", "F4", "A4"] },
                { name: "E Minor", notes: ["E4", "G4", "B4"] },
                { name: "C Minor", notes: ["C4", "Eb4", "G4"] },
                { name: "Bb Major", notes: ["Bb3", "D4", "F4"] },
                { name: "G Minor", notes: ["G3", "Bb3", "D4"] },
                { name: "F Major (Low)", notes: ["F3", "A3", "C4"] }
            ];

            // Define possible chord transitions (simple Markov chain)
            const chordTransitions = {
                "C Major": ["F Major", "G Major", "A Minor"],
                "F Major": ["D Minor", "Bb Major", "C Major"],
                "G Major": ["E Minor", "C Major", "D Minor"],
                "A Minor": ["D Minor", "E Minor", "F Major"],
                "D Minor": ["G Minor", "A Minor", "F Major"],
                "E Minor": ["A Minor", "G Major", "C Major"],
                "C Minor": ["G Minor", "Bb Major", "F Minor"],
                "Bb Major": ["Eb Major", "F Major", "G Minor"],
                "G Minor": ["C Minor", "D Minor", "Bb Major"],
                "F Major (Low)": ["Bb Major", "C Major", "D Minor"]
            };

            let synth = null;
            let loop = null;
            let currentChord = null;
            let isPlaying = false;

            playChordButton.disabled = false;

            playChordButton.addEventListener('click', () => {
                if (isPlaying) {
                    // Stop the progression
                    stopProgression();
                } else {
                    // Start the progression
                    startProgression();
                }
            });

            function startProgression() {
                isPlaying = true;

                // Create a synth if it doesn't exist
                if (!synth) {
                    synth = new Tone.PolySynth(Tone.Synth, {
                        envelope: {
                            attack: 0.01,
                            decay: 0.1,
                            sustain: 0.5,
                            release: 0.2
                        }
                    }).toDestination();
                } else {
                    // Cancel any scheduled events and release all notes
                    synth.releaseAll();
                    synth.cancel();
                }

                // Initialize current chord and tempo
                currentChord = chords[Math.floor(Math.random() * chords.length)];
                Tone.Transport.bpm.value = 100; // Starting tempo

                // Function to get the next chord
                function getNextChord() {
                    const possibleChords = chordTransitions[currentChord.name] || chords.map(c => c.name);
                    const nextChordName = possibleChords[Math.floor(Math.random() * possibleChords.length)];
                    return chords.find(c => c.name === nextChordName) || chords[Math.floor(Math.random() * chords.length)];
                }

                // Function to update tempo occasionally
                function updateTempo() {
                    if (Math.random() < 0.2) {
                        const newTempo = 80 + Math.floor(Math.random() * 60); // Between 80 and 140 BPM
                        Tone.Transport.bpm.rampTo(newTempo, 2); // Ramp to new tempo over 2 seconds
                        console.log(`Tempo changed to ${newTempo} BPM`);
                    }
                }

                // Loop to play chords
                loop = new Tone.Loop(time => {
                    // Update tempo occasionally
                    updateTempo();

                    // Play the current chord
                    synth.triggerAttackRelease(currentChord.notes, '1n', time);
                    console.log(`Playing chord: ${currentChord.name} (${currentChord.notes.join(', ')})`);

                    // Update status
                    demoStatus.textContent = `Playing ${currentChord.name}`;
                    demoStatus.style.color = '#28a745';

                    // Schedule next chord
                    currentChord = getNextChord();
                }, '1n').start(0);

                // Start the transport
                Tone.Transport.start();

                playChordButton.textContent = 'Stop Chord Progression';
                demoStatus.textContent = `Playing ${currentChord.name}`;
                demoStatus.style.color = '#28a745';
            }

            function stopProgression() {
                isPlaying = false;

                // Stop and dispose the loop
                if (loop) {
                    loop.stop();
                    loop.dispose();
                    loop = null;
                }

                // Stop and cancel the transport
                Tone.Transport.stop();
                Tone.Transport.cancel(0); // Cancel all scheduled events

                // Cancel all scheduled events on the synth
                if (synth) {
                    synth.releaseAll();
                    synth.cancel();
                    // Do not dispose the synth
                }

                playChordButton.textContent = 'Start Chord Progression';
                demoStatus.textContent = 'Status: Chord progression stopped.';
                demoStatus.style.color = '#cccccc';
            }
        }
    </script>
</body>
</html>