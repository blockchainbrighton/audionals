<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ToneJS Bridge by Audionals (v14.7.40) </title>
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    
        /* Color Variables */
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --dark-text-color: #333333;
            --header-bg: #1a1a1a;
            --secondary-bg: #333333;
            --orange: #ff8c00; /* Primary orange color */
            --light-orange: #ffaa43; /* Primary orange color */
            --light-grey: #dddddd;
            --blue: #007bff;
            --dark-blue: #0056b3;
            --disabled-grey: #6c757d;
            --border-color: #444444;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
            --orange: #ff8c00; /* New orange color */
        }
    
        /* Body Styling */
        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
    
        /* Shared Container Styling */
        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            background-color: var(--header-bg);
            color: var(--text-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
    
        /* Header and Thanks Styling */
        #header, #thanks {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px; /* Added spacing between header, thanks, and other sections */
        }
    
        #header {
            font-size: 28px;
        }
    
        #thanks {
            background-color: var(--secondary-bg);
            color: var(--light-grey);
            font-size: 16px;
        }
    
        /* Button Styling */
        #playChordButton {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: var(--orange); /* Set to primary orange */
            color: var(--dark-text-color);
            transition: background-color 0.3s;
            width: 100%;
            max-width: 600px;
            box-shadow: var(--shadow);
            margin-bottom: 20px; /* Added spacing below the button */
        }

        #playChordButton:hover:not(:disabled) {
            background-color: var(--light-orange); /* Darker orange on hover */
        }

        #playChordButton:disabled {
            background-color: var(--disabled-grey);
            cursor: not-allowed;
        }
    
        /* Drop-Down Menu Styling */
        details {
            background-color: var(--header-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin-bottom: 20px; /* Added spacing below the dropdown */
        }
    
        summary {
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: var(--orange); /* Apply orange color */
        }
    
        summary:before {
            content: "â–¶ ";
            display: inline-block;
            margin-right: 10px;
            transition: transform 0.2s;
        }
    
        details[open] summary:before {
            transform: rotate(90deg);
        }
    
        /* Code Styling */
        pre, code {
            background-color: #2c2c2c;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px; /* Added spacing below code blocks */
        }
    
        code {
            padding: 2px 4px;
        }
    
        /* Demo App Container Styling */
        #demoAppContainer {
            font-family: Arial, sans-serif;
            text-align: center;
            border: 1px solid var(--border-color);
            margin-bottom: 20px; /* Added spacing below the demo app container */
        }
    
        #demoAppHeader {
            width:600px;
            font-size: 20px;
            margin-bottom: 15px;
        }
    
        #demoStatus {
            margin-top: 15px;
            font-size: 14px;
            color: #cccccc;
        }
    
        /* Responsive Adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
    
            summary {
                font-size: 16px;
            }
    
            #demoAppHeader {
                font-size: 18px;
            }
    
            #playChordButton {
                font-size: 14px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <div id="header"><strong>Audionals And Ordinal Based 1's Present . . .</div><div id="thanks">Immutable gratitude to The Ordinal Based 1 Team, for inscribing the Tone.js library on The Blockchain.<br><br>Also to Audionals and jim.btc for building this bridge to make it more accessible for everyone.
    </strong></div>
    <details><summary>View Example Implementation: How to use this script in your own Web3 applications</summary><pre>
        &lt;!DOCTYPE html&gt;
        &lt;html lang="en"&gt;
        &lt;head&gt;
            &lt;meta charset="UTF-8"&gt;
            &lt;title&gt;My Web3 App with ToneJS&lt;/title&gt;
            &lt;style&gt;
                body { font-family: Arial, sans-serif; margin: 20px; background-color: #ffffff; color: #000000; }
                #playButton { padding: 10px 20px; font-size: 16px; cursor: pointer; }
                #status { margin-top: 20px; }
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
        
            &lt;button id="playButton"&gt;Play a Note&lt;/button&gt;
            &lt;div id="status"&gt;Status: Loading ToneJS...&lt;/div&gt;
        
            &lt;!-- Include the link to the ToneJS Bridge by Audionals (v14.7.40) Script --&gt;
            &lt;script src="path/to/tonejs-bridge.html"&gt;&lt;/script&gt;
            &lt;!-- Replace "path/to/" with the actual web3 URL for the bridge file (/content/{ordinalID}) --&gt;
        
            &lt;script&gt;
                // Your JavaScript code to use ToneJS goes here
            &lt;/script&gt;
        &lt;/body&gt;
        &lt;/html&gt;
                </pre></details>
    </div>
        <!-- Demo App Container -->
        <div id="demoAppContainer">
            <div id="demoAppHeader">Test The Web3 Tone.js Library Using The Button Below.      

            </div>
            <div id="demoStatus">Status: Ready to play.</div>
        </div>
    <button id="playChordButton"><strong>Click to Start Generative Chord Progression Using Tone.js</strong></button>

    <!-- ToneJS Bridge Module Inclusion -->
    <script>
        /**
         * ToneJS Bridge Module
         *
         * Fetches the ToneJS library from an external HTML file, decodes and decompresses
         * the embedded Base64-encoded GZIP data, and injects the library into the document.
         */
        const ToneJSBridge = (() => {
            let isLoaded = false;
            let loadPromise = null;

            /**
             * Fetches the external HTML file containing the Base64-encoded GZIP ToneJS library.
             * @param {string} url - The URL of the external HTML file.
             * @returns {Promise<string>} - The Base64-encoded GZIP data.
             */
            async function fetchExternalLibrary(url) {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch external library: ${response.status} ${response.statusText}`);
                }
                const htmlText = await response.text();

                // Parse the fetched HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');

                // Extract the <textarea id="base64Input"> content
                const textarea = doc.querySelector('#base64Input');
                if (!textarea) {
                    throw new Error('No <textarea id="base64Input"> found in the external HTML.');
                }

                let base64EncodedGzip = textarea.value.trim();

                // Remove whitespace and data URI prefix if present
                base64EncodedGzip = base64EncodedGzip.replace(/\s/g, '').replace(/^data:application\/octet-stream;base64,/, '');

                if (!base64EncodedGzip) {
                    throw new Error('Base64 encoded content is empty.');
                }

                return base64EncodedGzip;
            }

            /**
             * Decompresses the Base64-encoded GZIP data and returns the decompressed text.
             * @param {string} base64EncodedGzip - The Base64-encoded GZIP string.
             * @returns {Promise<string>} - The decompressed ToneJS library as text.
             */
            async function decompressLibrary(base64EncodedGzip) {
                // Decode Base64 to binary string
                let binaryString;
                try {
                    binaryString = atob(base64EncodedGzip);
                } catch (error) {
                    throw new Error('Base64 decoding failed. Ensure the data is correctly encoded.');
                }

                // Convert binary string to Uint8Array
                const uintArray = Uint8Array.from(binaryString, char => char.charCodeAt(0));

                // Decompress the GZIP data
                const decompressedText = await decompressData(uintArray);
                return decompressedText;
            }

            /**
             * Decompresses GZIP data using the DecompressionStream API.
             * @param {Uint8Array} data - The GZIP-compressed data.
             * @returns {Promise<string>} - The decompressed text.
             */
            async function decompressData(data) {
                if ('DecompressionStream' in window) {
                    try {
                        const ds = new DecompressionStream('gzip');
                        const decompressedStream = new Response(data).body.pipeThrough(ds);
                        const blob = await new Response(decompressedStream).blob();
                        const text = await blob.text();
                        return text;
                    } catch (error) {
                        throw new Error('DecompressionStream failed. Ensure the data is valid GZIP format.');
                    }
                } else {
                    throw new Error('DecompressionStream is not supported in this browser.');
                }
            }

            /**
             * Injects the decompressed ToneJS library into the document.
             * @param {string} libraryText - The decompressed ToneJS library as text.
             */
            function injectLibrary(libraryText) {
                const script = document.createElement('script');
                script.textContent = libraryText;
                document.body.appendChild(script);
            }

            /**
             * Loads the ToneJS library from the specified external HTML file.
             * @param {string} externalHtmlUrl - The URL of the external HTML file containing the library.
             * @returns {Promise<void>}
             */
            async function load(externalHtmlUrl) {
                if (isLoaded) {
                    return Promise.resolve();
                }
                if (loadPromise) {
                    return loadPromise;
                }

                loadPromise = (async () => {
                    try {
                        const base64Gzip = await fetchExternalLibrary(externalHtmlUrl);
                        const libraryText = await decompressLibrary(base64Gzip);
                        injectLibrary(libraryText);
                        isLoaded = true;
                        // Dispatch a custom event to signal that ToneJS is loaded
                        document.dispatchEvent(new Event('tonejsLoaded'));
                    } catch (error) {
                        // Dispatch an event for error handling
                        document.dispatchEvent(new CustomEvent('tonejsLoadError', { detail: error }));
                        throw error;
                    }
                })();

                return loadPromise;
            }

            return {
                load,
            };
        })();
    </script>

    <!-- Invocation of the Bridge Module and Demo Initialization -->
    <script>
        // Listen for the 'tonejsLoaded' event to initialize the demo app
        document.addEventListener('tonejsLoaded', () => {
            // Update the header with the version number
            const header = document.getElementById('header');
            if (typeof Tone !== 'undefined' && Tone.version) {
                header.textContent = `Tone.js v${Tone.version}`;
            } else {
                header.textContent = `Tone.js :: From Audionals and Ordinal Based 1's`;
            }

            // Initialize the Demo App
            initializeDemoApp();
        });

        // Listen for the 'tonejsLoadError' event to display error message
        document.addEventListener('tonejsLoadError', (event) => {
            // Display an error message
            const header = document.getElementById('header');
            header.textContent = 'Failed to load Tone.js';
            console.error('ToneJS Load Error:', event.detail);
        });

        // Load the ToneJS library using the bridge
        document.addEventListener('DOMContentLoaded', () => {
            // Hard-coded URL to the external HTML file containing the ToneJS library
            const externalLibraryURL = 'https://ordinals.com/content/1bda678460ef08fb64435b57c9b69fd78fd4556822ccd8e9839b4eb71b3621edi0';

            ToneJSBridge.load(externalLibraryURL)
                .then(() => {
                    console.log('ToneJS has been loaded and is ready to use.');
                })
                .catch(error => {
                    console.error('Failed to load ToneJS:', error);
                });
        });

 /**
 * Function to initialize the Demo App's functionalities.
 */
function initializeDemoApp() {
    const playChordButton = document.getElementById('playChordButton');
    const demoStatus = document.getElementById('demoStatus');

    // Define chords with their notes and names
    const chords = [
        { name: "C Major", notes: ["C4", "E4", "G4"] },
        { name: "F Major", notes: ["F4", "A4", "C5"] },
        { name: "G Major", notes: ["G4", "B4", "D5"] },
        { name: "A Minor", notes: ["A4", "C5", "E5"] },
        { name: "D Minor", notes: ["D4", "F4", "A4"] },
        { name: "E Minor", notes: ["E4", "G4", "B4"] },
        { name: "C Minor", notes: ["C4", "Eb4", "G4"] },
        { name: "Bb Major", notes: ["Bb3", "D4", "F4"] },
        { name: "G Minor", notes: ["G3", "Bb3", "D4"] },
        { name: "F Major (Low)", notes: ["F3", "A3", "C4"] }
    ];

    // Define possible chord transitions (simple Markov chain)
    const chordTransitions = {
        "C Major": ["F Major", "G Major", "A Minor"],
        "F Major": ["D Minor", "Bb Major", "C Major"],
        "G Major": ["E Minor", "C Major", "D Minor"],
        "A Minor": ["D Minor", "E Minor", "F Major"],
        "D Minor": ["G Minor", "A Minor", "F Major"],
        "E Minor": ["A Minor", "G Major", "C Major"],
        "C Minor": ["G Minor", "Bb Major", "F Minor"],
        "Bb Major": ["Eb Major", "F Major", "G Minor"],
        "G Minor": ["C Minor", "D Minor", "Bb Major"],
        "F Major (Low)": ["Bb Major", "C Major", "D Minor"]
    };

    let synth = null;
    let loop = null;
    let currentChord = null;
    let isPlaying = false;

    playChordButton.addEventListener('click', () => {
        if (typeof Tone === 'undefined') {
            demoStatus.textContent = 'Status: ToneJS is not loaded.';
            demoStatus.style.color = '#ff4d4d';
            console.error('ToneJS is not loaded.');
            return;
        }

        if (isPlaying) {
            // Stop the progression
            stopProgression();
        } else {
            // Start the progression
            startProgression();
        }
    });

    function startProgression() {
        isPlaying = true;

        // Create a synth if it doesn't exist
        if (!synth) {
            synth = new Tone.PolySynth(Tone.Synth, {
                envelope: {
                    attack: 0.01,
                    decay: 0.1,
                    sustain: 0.5,
                    release: 0.2
                }
            }).toDestination();
        } else {
            // Cancel any scheduled events and release all notes
            synth.releaseAll();
        }

        // Initialize current chord and tempo
        currentChord = chords[Math.floor(Math.random() * chords.length)];
        Tone.Transport.bpm.value = 100; // Starting tempo

        // Function to get the next chord
        function getNextChord() {
            const possibleChords = chordTransitions[currentChord.name] || chords.map(c => c.name);
            const nextChordName = possibleChords[Math.floor(Math.random() * possibleChords.length)];
            return chords.find(c => c.name === nextChordName) || chords[Math.floor(Math.random() * chords.length)];
        }

        // Function to update tempo occasionally
        function updateTempo() {
            if (Math.random() < 0.2) {
                const newTempo = 80 + Math.floor(Math.random() * 60); // Between 80 and 140 BPM
                Tone.Transport.bpm.rampTo(newTempo, 2); // Ramp to new tempo over 2 seconds
                console.log(`Tempo changed to ${newTempo} BPM`);
            }
        }

        // Loop to play chords
        loop = new Tone.Loop(time => {
            // Update tempo occasionally
            updateTempo();

            // Play the current chord
            synth.triggerAttackRelease(currentChord.notes, '1n', time);
            console.log(`Playing chord: ${currentChord.name} (${currentChord.notes.join(', ')})`);

            // Update status
            demoStatus.textContent = `Playing ${currentChord.name}`;
            demoStatus.style.color = '#28a745';

            // Schedule next chord
            currentChord = getNextChord();
        }, '1n').start(0);

        // Start the transport
        Tone.Transport.start();

        playChordButton.textContent = 'Stop Chord Progression';
        demoStatus.textContent = `Playing ${currentChord.name}`;
        demoStatus.style.color = '#28a745';
    }

    function stopProgression() {
        isPlaying = false;

        // Stop and dispose the loop
        if (loop) {
            loop.stop();
            loop.dispose();
            loop = null;
        }

        // Stop and cancel the transport
        Tone.Transport.stop();
        Tone.Transport.cancel(0); // Cancel all scheduled events

        // Cancel all scheduled events on the synth
        if (synth) {
            synth.releaseAll();
            // Do not dispose the synth
            // synth.dispose();
            // synth = null;
        }

        playChordButton.textContent = 'Start Chord Progression';
        demoStatus.textContent = 'Status: Chord progression stopped.';
        demoStatus.style.color = '#cccccc';
    }
}
    </script>


</body>
</html>