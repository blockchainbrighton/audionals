// seedManager.js
(()=>{const e=e=>console.log(`[${(new Date).toISOString()}] ${e}`),t="hidden";window.togglePanel=e=>{const n=document.getElementById(e);if(n){n.classList.toggle(t);const e=n.classList.contains(t);n.setAttribute("aria-hidden",e)}else console.error(`${e.replace(/-/g," ")} not found.`)},window.populateTrackList=()=>{const e=document.getElementById("track-list-container");e.innerHTML="";const t=globalData?.songsArray;t?.length?t.forEach((({id:t,artist:n})=>{const o=document.createElement("div");o.className="track-item",o.innerHTML=`<div class="track-name">${t}</div><div class="track-artist">${n}</div>`,e.appendChild(o)})):e.textContent="No tracks available."},window.toggleTrackListAndPopulate=()=>{togglePanel("track-list-panel");const e=document.getElementById("track-list-panel");e&&!e.classList.contains(t)&&populateTrackList()};const n=()=>{let e="";for(;e=Array.from({length:16},(()=>Math.floor(10*Math.random()))).join(""),!(BigInt(e)<=BigInt(Number.MAX_SAFE_INTEGER)););return e},o=e=>new URLSearchParams(window.location.search).get(e);let d=o("seed")||n();if((!/^\d{16}$/.test(d)||BigInt(d)>BigInt(Number.MAX_SAFE_INTEGER))&&(e(`Invalid seed provided: "${d}". Generating a new seed.`),d=n()),window.seed=d,e(`Using seed: ${window.seed}`),o("seed")){const e=new URL(window.location);e.searchParams.delete("seed"),history.replaceState(null,"",e.toString())}const l=BigInt(window.seed);e(`Converted seed to BigInt: ${l}`);const r=[80,100,120,140,160,180,240],i=((t=>{const n=t.split("").reduce(((e,t)=>{const n=parseInt(t,10);return(10*e+(isNaN(n)?0:n))%1000000007}),0),o=r[n%r.length];e(`Seed: ${t}, Hash: ${n}, Selected BPM: ${o}`)})(window.seed),()=>{const e=JSON.parse(localStorage.getItem("previousSeeds"))||[];return s(e),e}),s=e=>{const t=document.getElementById("previous-seeds-container");if(!t)return;const n=t.querySelector("ul");n&&(n.innerHTML=e.length?e.map((e=>`\n                    <li>\n                        <span>${e}</span>\n                        <button onclick="copyToClipboard('${e}')">Copy</button>\n                    </li>`)).join(""):"<li>No previous seeds.</li>")};window.copyToClipboard=e=>{navigator.clipboard.writeText(e).then((()=>alert(`Seed copied to clipboard: ${e}`))).catch((e=>console.error("Could not copy text:",e)))};const a=()=>{confirm("Are you sure you want to clear all previous seeds?")&&(localStorage.removeItem("previousSeeds"),s([]),e("All previous seeds have been cleared."))},c=(t,n,o="The Infinite Ordinal Remix")=>{const d=document.getElementById("seed-mgmt-canvas");if(!d)return;const l=d.getContext("2d");l.clearRect(0,0,d.width,d.height),l.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--seed-bg-color")||"green",l.fillRect(0,0,d.width,d.height/2),l.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--bpm-bg-color")||"orange",l.fillRect(0,d.height/2,d.width,d.height/2),l.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--text-color")||"white",l.font=`${getComputedStyle(document.documentElement).getPropertyValue("--font-size")||"16px"} Arial`,l.textAlign="center",l.textBaseline="middle",l.fillText(`Seed: ${t}`,d.width/2,d.height/4),l.fillText(`BPM: ${n}`,d.width/2,3*d.height/4),(t=>{const n=i();n.includes(t)||(n.push(t),localStorage.setItem("previousSeeds",JSON.stringify(n)),s(n),e(`Seed saved: ${t}`))})(t);const r=document.querySelector("#nowPlayingContainer .current-seed");r&&(r.textContent=`Seed: ${t}`,e(`Updated current seed display: ${t}`));const a=document.querySelector("#nowPlayingContainer .title");a&&o&&(a.textContent=o,e(`Updated current song title: ${o}`))};window.displaySeedAndBPM=c;(()=>{document.addEventListener("DOMContentLoaded",(()=>{if(globalData.songsArray.length>0){const e=globalData.songsArray[0];c(e.seed,e.bpm,e.id),globalData.currentSongIndex=0}else console.warn("No song mixes generated.");i()})),document.getElementById("clear-seeds-button")?.addEventListener("click",a),document.getElementById("load-seed-button")?.addEventListener("click",(()=>{const e=document.getElementById("seed-input").value.trim();if(!e)return void alert("Please enter a seed.");if(!(/^\d{16}$/.test(t=e)?!(BigInt(t)>BigInt(Number.MAX_SAFE_INTEGER)&&(alert(`Seed must be a number up to ${Number.MAX_SAFE_INTEGER}.`),1)):(alert("Seed must be a 16-digit numeric string."),0)))return;var t;const n=new URL(window.location);n.searchParams.set("seed",e),window.location.href=n.toString()}));const e=document.getElementById("seed-input");e&&e.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("load-seed-button").click())}))})()})();
