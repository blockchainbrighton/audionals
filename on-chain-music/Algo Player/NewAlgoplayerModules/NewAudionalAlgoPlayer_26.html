<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audionals - Web3 Music Player</title>
    <custommetadata>
        <script>
            const artworkUrl = ["/content/01c48d3cceb02215bc3d44f9a2dc7fba63ea63719a2ef1c35d3f0c4db93ab8d5i0"];
            const songDataUrls = [
                "/content/8aec0a99a5617b9da98a5b63a11a5143f0cac3cfa662d9515c2285de03ef95d4i0", // CHEESE 
                "/content/5527d0cc95ce5ce6eedf4e275234da8b1fe087512d0db618b6de1aaad437c96bi0", // TRUTH
                "/content/6d288c0c82653001bb32497889dd1486e8afec9b0671a95fa9e10f99c20737bbi0", // KORA
                "/content/119a3ccd1dfd7e987cca139f86d16717d845a22dd6afc59ad492527b95ae9a91i0", // MLK I HAVE A DREAM
                "/content/db9131cfe8e933e8e639f007dcd2b582a80bfd2be42b0eafa4d2e206332d6785i0", // ModernProgress
                "/content/07ff7bdc47e5272a3ff55cc46d2b189d510562a057a2c24112f3d0376950484di0", // CHOPPIN' IT UP
                "/content/fb0d2abcd1fa5bf2622579f0990435b48d41291f71626fc2e36a93e6ea6b3b85i0", // HUMANITY // Turn Down Channels 1 + 2 (Apollo 13) Turn down Channel 5 - Hindenburg /  Turn channel 8 up - Hi hats
                "/content/a4fb0b49181975450a6710f20128eb0b3acc51f4aa1ce87ebdbc9607562013a2i0", // MintyFresh Vibes
                "/content/633100d631767ddb9a309f5a2a66f5a66d5abd839f3b1c55642690d484189971i0", // ON DAY ONE
                "/content/85436950f53c57aa0c510071d2d5f1c187e1d21e4e57210fcae152c4c7b6a768i0", // Rhythm and Bass 240
                "/content/e3ca12dd7516b4e486af4e3fa7f4ebc535d825034ff3c9da4954f354572dcf61i0", // Crazy Ass Bitch
                "/content/d0496a8e1657ce470807c8d47dcb5f1018a32d8ec8e50d490ad49411ffee1457i0", // Rhythm and Bass 60
                "/content/b22f1c85371b58a9cdac19b2baa50b1f9025a28d44cdfaad539d0527aa7d894ei0", // ON-CHAIN IN THE MEMBRANE
                "/content/5ee46b8f645a65b0ec8ae749a28f88e364347f89137bb79986355bf5fb94cbebi0", // Fiat Money by Solemn
                "/content/c41de57f1e062a440a9fc96d54baaccd7ec40049f48e9f3880559afc60b1b09ai0", // When You Know
                "/content/9dfa1812b211a7ac8b2f9e77119828ec8fbf2e9016b3d37a8efd70052eb4aa3ci0", // Based New Song
                "/content/4653bcc45671abdbc024b03ebbaaadb30e0cad83b80898894ab22426bbccdaaei0", // Freedom to Transact

            ];

            // Define the projectArtistMap globally
                window.projectArtistMap = {
                    "I Love Cheese 2024 FINAL": "melophonic + Rex Speedway and The Denim Avengers",
                    "TRUTH": "melophonic",
                    "Kora Algo New": "melophonic",
                    "MLK 120": "melophonic",
                    "Modern Progress Vocal": "jim.btc",
                    "Choppin' It Up": "Jim.btc",
                    "HUMANITY": "Jim.btc",
                    "Minty Fresh v2": "melophonic + Rare Scrilla",
                    "How We Be - Based": "Based.btc",
                    "Rhythm and Bass": "Jim.btc",
                    "CrazyAssBitch": "French Montana + Audionals",
                    "Rhythm and Bass @60": "Jim.btc",
                    "On-Chain in the Membrane": "melophonic",
                    "FIAT MONEY": "Solemn",
                    "didd you know 1": "Solemn",
                    "Bear Market Disco": "Based.btc",
                    "FREEDOM TO TRANSACT REMIX": "melophonic",

                    // Add more mappings here as needed
                };
        </script>
    </custommetadata>
    <globaldefinitions>
        <script>
            const globalData = window.globalData = {
                isInRemixMode: false,               // Indicates if the player is in remix mode
                isPlaying: false,                  // Indicates if playback is active
                currentSongIndex: 0,               // Index of the currently playing song
                songsArray: [],                    // Array holding the list of songs
                audioBuffers: {},                  // Loaded audio buffers for normal playback
                reverseAudioBuffers: {},           // Loaded audio buffers for reverse playback
                audioContext: new (window.AudioContext || window.webkitAudioContext)(), // Web Audio API context
                masterGain: null,                  // Master gain node (initialized below)
                gainNodes: {},                     // Gain nodes per song and channel
                startPlayback: null,               // Function to start playback
                stopPlayback: null,                // Function to stop playback
                togglePlayback: null,              // Function to toggle playback
                resetPlayback: null,               // Function to reset playback
                isArtworkCover: true,
                isVisualiserCover: false,
                // Continuous playback is now default
            };

        
            // Initialize master gain node
            globalData.masterGain = globalData.audioContext.createGain();
            globalData.masterGain.connect(globalData.audioContext.destination);
        </script>
    </globaldefinitions>
    
 <!-- Existing Styles -->
 <link rel="stylesheet" href="/content/d2d6df9b0c5eedacbf7005e4c0a8bdb0dce76ee278b23dbb7507213608349ecei0">


<!-- New Styles for Metadata Panels and Buttons-->
<style>
/* new styles for metadata displays */
#trackListingPanel {position: fixed;top: 0;left: -420px;width: 400px;height: 100%;background: rgba(45, 45, 45, 0.95);color: #ffffff;padding: 10px 15px;box-shadow: 2px 0 12px rgba(0, 0, 0, 0.8);overflow-y: auto;transition: left 0.3s ease;z-index: 2999;}#trackListingPanel.visible {left: 0;}#infoPanel {position: fixed;top: 20px;left: 50%;transform: translateX(-50%);width: 300px;padding: 20px;background-color: rgba(0, 0, 0, 0.9);color: #ffffff;border-radius: 8px;box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.5);z-index: 1003;display: none;text-align: left;}#infoPanel.visible {display: block;}.hidden {display: none;}#toggleInstruction {top: 10px;right: 20px;background-color: #3498db;color: #fff;border: none;padding: 10px 20px;border-radius: 5px;cursor: pointer;}.metadataItem {margin-bottom: 5px;display: flex;justify-content: space-between;}.metadataItem h2 {margin: 0;font-size: 1em;}.metadataItem p {margin: 0;font-size: 0.9em;color: #ffaa00;}#metadataContent {max-height: 90%;overflow-y: auto;}#nowPlayingContainer {position: fixed;bottom: 0;left: 50%;transform: translateX(-50%);width: auto;background-color: rgba(20, 20, 20, 0.95);color: #fff;padding: 10px;display: flex;justify-content: center;align-items: center;box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);z-index: 1000;text-align: center;}#nowPlayingText {display: flex;flex-direction: column;align-items: center;}#nowPlayingText .songTitle {font-size: 1.2em;font-weight: bold;}#nowPlayingText .artistName {font-size: 1em;margin-top: 5px;}#buttonContainer {position: fixed;top: 0;left: 50%;transform: translateX(-50%);background-color: rgba(0, 0, 0, 0.9);padding: 10px;display: flex;gap: 15px;z-index: 1002;}#buttonContainer button {background-color: #3498db;color: #fff;padding: 10px 20px;border: none;border-radius: 5px;cursor: pointer;transition: background-color 0.3s ease;}#buttonContainer button:hover {background-color: #2980b9;}
</style>


</head>
<htmlElements>
        <body>
        <h1>Audionals</h1>
        <div id="loadingSpinner"></div>
        <div id="artworkCover">
            <img id="artworkImage" src="" alt="Artwork Cover">
        </div>

        <!-- New Metadata Panel -->
        <div id="trackListingPanel">
            <h2>Track Listings:</h2>
            <div id="metadataContent">
                <!-- Metadata items will be dynamically inserted here -->
            </div>
        </div>

        <!-- New Now Playing Container -->
        <div id="nowPlayingContainer">
            <div id="nowPlayingText">
                <!-- Now Playing info will be dynamically inserted here -->
                <span class="songTitle">No song playing</span>
                <span class="artistName"></span>
            </div>
        </div>

<!-- Button Container -->
<div id="buttonContainer">
    <button id="playButton" onclick="globalData.togglePlayback()">Play / Stop</button>
    <!-- Updated Previous and Next Buttons -->
    <button id="prevButton" onclick="globalData.previousSong()">Previous</button>
    <button id="nextButton" onclick="globalData.nextSong()">Next</button>
    <button id="toggleInstruction" onclick="globalData.toggleInfo()">Info</button>

</div>

<!-- Information Panel -->
<div id="infoPanel" class="hidden">
    <h2>Audional Player Info</h2>
    <ul>
        <li>Press <strong>T</strong> to view the Track List.</li>
        <li>Use <strong>Left</strong> and <strong>Right</strong> arrows to navigate the Track List.</li>

    </ul>
</div>


</htmlElements>   



<!-- Global Project-Artist Mapping and Helper Function -->
<script>
//projectArtistMapping.js
function getProjectAndArtist(t){let n="Unknown Project Name",e="Unknown Artist Name";if(t.id){const e=t.id.match(/Song\s+\d+:\s+(.+)/);e&&e[1]&&(n=e[1].trim())}return window.projectArtistMap&&window.projectArtistMap[n]?e=window.projectArtistMap[n]:t.artist&&(e=t.artist),{projectName:n,artistName:e}}globalData.toggleInfo=function(){document.getElementById("infoPanel").classList.toggle("visible")};
</script>


<!-- Unified Metadata Management and Logging Script -->
<script>
// unifiedMetadataManagement.js
(()=>{const t=t=>t?.match(/Song\s+\d+:\s+(.+)/)?.[1]?.trim()||"UNKNOWN PROJECT NAME",a=(t,a,e)=>a?.[t]||e||"Unknown Artist Name",e=e=>{if(!Array.isArray(e)||!e.length)return void console.warn("No songs data available to process.");const n=(e=>{const n=window.globalData?.projectArtistMap||window.projectArtistMap||{};return e.map(((e,o)=>({trackNumber:o+1,projectName:t(e.id),artistName:a(t(e.id),n,e.artist)})))})(e);(t=>{const a=document.getElementById("metadataContent");if(!a)return console.warn("Metadata content container (#metadataContent) not found.");a.innerHTML=t.map((({trackNumber:t,projectName:a,artistName:e})=>`<div class="metadataItem"><h2>${t}. ${a}</h2><p>${e}</p></div>`)).join("")})(n),(t=>{t.forEach((({projectName:t,artistName:a})=>console.log(`Project Name: ${t}, Artist Name: ${a}`)))})(n)},n=()=>{window.globalData?.songsArray?.length?e(window.globalData.songsArray):document.addEventListener("dataLoadingComplete",(({detail:{songs:t}={}})=>e(t))),document.addEventListener("keydown",(({key:t})=>{"t"===t.toLowerCase()&&(()=>{const t=document.getElementById("trackListingPanel");t?t.classList.toggle("visible"):console.warn("Metadata panel container (#trackListingPanel) not found.")})()}))};try{n()}catch(t){console.error("Error initializing Metadata Management and Logging:",t)}})();
</script>




<!-- Section 1a - Loading and Preparing Song Data  -->
<script src="/content/44088e23250de51c70149b344a11ba29fe39850ac9b3bf2aa99e73f5d29c4825i0"></script>





<!-- Section 1.5 - Gain Nodes and Helpers -->
<script>
// GainNodeHelpers.js
window.GainNodeHelper=(()=>{const n=window.globalData||(window.globalData={gainNodes:{}}),{gainNodes:o,audioContext:e,masterGain:a}=n;a||(n.masterGain=e.createGain(),n.masterGain.connect(e.destination));let t=null,l=null,s=!1;const c=(a,c=!1)=>{const{id:i,channels:r}=a;c?l=i:t=i,r.length?(o[i]=o[i]??{},r.forEach((({id:a})=>{if(!o[i][a]){const t=e.createGain();t.gain.value=1,t.connect(n.masterGain),o[i][a]=t}})),t&&l&&!s&&(console.log("Gain Nodes Map:",{currentSong:o[t]??{},nextSong:o[l]??{}}),s=!0)):console.warn(`No channels found for song ${i}.`)};return{createGainNodesForSong:n=>c(n,!1),prepareNextSong:n=>c(n,!0),cleanupGainNodesForSong:n=>{const e=o[n];e?(Object.values(e).forEach((n=>n.disconnect())),console.log(`Cleaned up gain nodes for Song ID: ${n}`),delete o[n],n!==t&&n!==l||(n===t&&(t=null),n===l&&(l=null),s=!1)):console.warn(`No gain nodes found to clean up for song ${n}.`)}}})();
</script>







<!-- Section 2 - audioProcessingAndManagement.js -->
<script src="/content/f4cc99813b43f71b3e781d3c99f24a6a7a5b1004ea0efce3b225011e347b8df0i0"></script>


<!-- Section 2.5 - Rebalancing channel volumes after normalisation -->
<script>
// DynamicGainBalancer.js
const DynamicGainBalancer=(()=>{const n=window.globalData||(window.globalData={normalizationFactors:{},balancerGainNodes:{}}),{normalizationFactors:o,balancerGainNodes:a,audioContext:e,masterGain:t}=n,r=(n,a,e)=>{o[n]=o[n]??{},o[n][a]=e,console.log(`Stored normalization factor for Song ID: ${n}, Channel ID: ${a}: ${e}`)},c=({id:n,channels:r})=>{r.length?r.forEach((({id:r})=>((n,r)=>{const c=o[n]?.[r];if(c&&1!==c){const o=1/c,l=e.createGain();l.gain.value=o,l.connect(t),a[n]=a[n]??{},a[n][r]=l,console.log(`Applied inverse gain for Song ID: ${n}, Channel ID: ${r}, Gain: ${o}`)}})(n,r))):console.warn(`No channels found for song ${n}.`)},l=n=>{const o=a[n];o?(Object.values(o).forEach((n=>{n.disconnect()})),console.log(`Cleaned up balancer gain nodes for Song ID: ${n}`),delete a[n]):console.warn(`No balancer gain nodes found to clean up for song ${n}.`)};return document.addEventListener("audioBufferNormalized",(({detail:{songId:n,channelId:o,normalizationFactor:a}})=>{r(n,o,a)})),document.addEventListener("songPlaybackStarted",(({detail:{currentSong:n}})=>{c(n)})),document.addEventListener("songPlaybackEnded",(({detail:{songId:n}})=>{l(n)})),{storeNormalizationFactor:r,createBalancerGainNodesForSong:c,cleanupBalancerGainNodesForSong:l}})();
</script>





<!-- Section 3 - Playback Engine (Updated for Enhanced Reliability) -->
<!-- Playback Engine Script -->
<script>
// playbackEngine.js
(()=>{const e=window.globalData||(window.globalData={isPlaying:!1,currentSongIndex:0,songsArray:[],audioBuffers:{},reverseAudioBuffers:{},audioContext:new(window.AudioContext||window.webkitAudioContext),masterGain:null,gainNodes:{},isArtworkCover:!0,isVisualiserCover:!1}),{audioContext:n}=e,t=.1,o=25;let a=null,r={};const s=new Set,i=new Set;function c(){const{songsArray:i,currentSongIndex:l}=e;if(!i.length)return console.error("No songs available for playback.");const p=i[l%i.length],y=p.projectSequences||{},f=60/p.bpm/4,m=64*f;e.currentSongIndex%=i.length,r={},s.clear(),console.log(`Starting playback for Song: ${p.id} (${e.currentSongIndex+1}/${i.length}) with ${Object.keys(y).length} sequences.`),console.log(`Song BPM: ${p.bpm}`);let b=0;for(const[e,t]of Object.entries(y))r[e]={nextStepIndex:0,nextStepTime:n.currentTime+b,stepDuration:f,endTime:n.currentTime+b+m,completed:!1},b+=m;e.currentSongId=p.id,GainNodeHelper.createGainNodesForSong(p),GainNodeHelper.prepareNextSong(i[(e.currentSongIndex+1)%i.length]),e.isPlaying=!0,a=setInterval((()=>function(o){const a=n.currentTime;let s=!0;for(const[n,i]of Object.entries(o.projectSequences||{})){const c=r[n];if(c&&!c.completed)if(a>=c.endTime)c.completed=!0,console.log(`Sequence ${n} has completed.`);else for(s=!1;c.nextStepTime<a+t&&e.isPlaying;){const{nextStepIndex:e,nextStepTime:t,stepDuration:a}=c;for(const[n,a]of Object.entries(i)){const r=parseInt(n.slice(2),10),s=o.channels[r];if(!s){console.warn(`Channel index ${r} not found in song ${o.id}.`);continue}const i=a.steps?.find((n=>"number"==typeof n?n===e:n.index===e));if(void 0!==i){const e="object"==typeof i&&i.reverse;u(o,s,t,e)}}if(c.nextStepIndex++,c.nextStepIndex>=64){c.completed=!0,console.log(`Sequence ${n} has completed all steps.`);break}c.nextStepTime+=a}}s&&(console.log("All sequences have completed."),function(){if(!e.isPlaying)return;e.currentSongIndex=(e.currentSongIndex+1)%e.songsArray.length,setTimeout((()=>{e.isPlaying&&d({preserveIsPlaying:!0,callback:c})}),200)}())}(p)),o),console.log("Sequences scheduled and playback started."),document.dispatchEvent(new CustomEvent("playbackStarted",{detail:{success:!0}})),g(p)}function l(){if(!e.isPlaying)return console.log("Playback is not in progress.");d(),console.log("Playback stopped."),document.dispatchEvent(new CustomEvent("playbackStopped",{detail:{success:!0}})),p()}function d(n={}){clearInterval(a),n.preserveIsPlaying||(e.isPlaying=!1),r={},s.clear(),i.forEach((e=>{try{e.stop(),e.disconnect()}catch(e){console.error("Error stopping/disconnecting an audio source:",e)}})),i.clear(),e.currentSongId&&(GainNodeHelper.cleanupGainNodesForSong(e.currentSongId),e.currentSongId=null),n.callback&&n.callback()}e.masterGain||(e.masterGain=n.createGain(),e.masterGain.connect(n.destination)),e.togglePlayback=()=>e.isPlaying?l():c(),e.startPlayback=c,e.stopPlayback=l,e.resetPlayback=()=>d({callback:c});const u=(t,o,a,r)=>{const c=`${t.id}_${o.id}_${r?"reverse":"normal"}`,l=r?e.reverseAudioBuffers[t.id]?.[o.id]:e.audioBuffers[t.id]?.[o.id];if(!l)return void(s.has(c)||(s.add(c),console.warn(`Audio buffer missing for Song: ${t.id}, Channel: ${o.id}${r?" (Reverse)":""}`)));const d=n.createBufferSource();d.buffer=l,d.playbackRate.value=o.metadata.playbackSpeed||1;const u=e.gainNodes?.[t.id]?.[o.id]||e.masterGain;d.connect(u),d.start(a),i.add(d),d.onended=()=>i.delete(d)};e.initializePlaybackEngine=()=>{if(!e.songsArray.length)return console.error("No songs available for playback.");console.log("Playback Engine Initialization Complete."),console.log("Playback is ready. Click the artwork to start.")};const g=e=>{const n=document.getElementById("nowPlayingContainer");if(!n)return console.warn("Now Playing Container not found.");const{projectName:t,artistName:o}=getProjectAndArtist(e);n.querySelector(".songTitle").textContent=t,n.querySelector(".artistName").textContent=o},p=()=>{const e=document.getElementById("nowPlayingContainer");if(!e)return console.warn("Now Playing Container not found.");e.querySelector(".songTitle").textContent="No song playing",e.querySelector(".artistName").textContent=""},y=()=>{document.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("artworkCover"),t=document.getElementById("artworkImage"),o=document.getElementById("loadingSpinner");e.isArtworkCover&&artworkUrl.length?(t.src=artworkUrl[0],n.classList.remove("hidden"),o.style.display="none",t.addEventListener("click",e.togglePlayback),console.log("Artwork cover is set up for playback toggle.")):console.warn("Artwork cover is not enabled or no artwork URL provided.")}))};document.addEventListener("initialAudioBuffersReady",(n=>{n.detail.success&&(e.initializePlaybackEngine(),console.log("Initial audio buffers are ready."))})),["playbackStarted","playbackStopped"].forEach((e=>{document.addEventListener(e,(n=>{n.detail.success&&console.log(`Playback has been successfully ${"playbackStarted"===e?"started":"stopped"}.`)}))})),y(),Object.keys(e.audioBuffers).length&&e.initializePlaybackEngine()})();
</script>




    

<!-- Keyboard Controls and Event Listeners Script -->
<script>
// keyboardControlsAndEventListeners.js
(()=>{const e=window.globalData||(window.globalData={}),o=e.audioContext;let n=null;const t=o=>{const n=e.songsArray.length;0!==n?("ArrowRight"===o?(e.currentSongIndex=(e.currentSongIndex+1)%n,console.log(`Skipped to next song: ${e.songsArray[e.currentSongIndex].id}`)):"ArrowLeft"===o&&(e.currentSongIndex=(e.currentSongIndex-1+n)%n,console.log(`Skipped to previous song: ${e.songsArray[e.currentSongIndex].id}`)),e.isPlaying?e.resetPlayback():(console.log("Playback is not active. Next song is cued and ready to play."),r(e.currentSongIndex))):console.error("No songs available to skip.")};e.nextSong=()=>t("ArrowRight"),e.previousSong=()=>t("ArrowLeft"),document.addEventListener("keydown",(e=>{"ArrowRight"!==e.key&&"ArrowLeft"!==e.key||(n&&clearTimeout(n),n=setTimeout((()=>{t(e.key)}),300))}));const r=o=>{const n=e.songsArray[o],t=document.getElementById("artworkImage"),r=document.getElementById("songTitle");t&&n.title&&n.title.length>0&&(t.src=n.artworkUrl||"default-artwork.png",console.log(`UI updated for Song: ${n.id}`)),r&&(r.textContent=n.title||"Unknown Title")};document.addEventListener("initialAudioBuffersReady",(function(e){e.detail.success&&console.log("Debugging Script: Audio buffers are ready.")})),o?(o.onstatechange=function(){console.log(`Debugging Script: AudioContext state changed to: ${o.state}`)},console.log("Debugging Script: AudioContext state change listener added.")):console.warn("Debugging Script: AudioContext not found."),["playbackStarted","playbackStopped"].forEach((e=>{document.addEventListener(e,(function(){console.log(`Debugging Script: '${e}' event dispatched.`)}))})),document.addEventListener("DOMContentLoaded",(function(){if(o){const e=async()=>{if("suspended"===o.state)try{await o.resume(),console.log("AudioContext resumed successfully.")}catch(e){console.error("Failed to resume AudioContext:",e)}};document.addEventListener("click",e),document.addEventListener("keydown",e),console.log("AudioContext resumption listeners added.")}else console.warn("AudioContext not found.")}))})();
</script>

    
    
    

</html>
